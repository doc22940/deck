!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var i=n(1),o=i.App;!function(){var e,t=o.areas={index:function(e,t){}},i=n(2);for(var e in i)t[e]=i[e];t.setting=n(12);var r=!1;try{r=localStorage.getItem("timelines").length>0}catch(a){}o.config("contentBody",r?"deck":"intro")}()},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="../dist",t(0)}([function(e,t,n){var i={};i.Core=n(1),i.View=n(2),i.TemplateView=n(4),i.ListView=n(5),i.FormView=n(6),i.AreaView=n(7),i.App=n(8),i.Http=n(3),i.MemoryCache=n(9),i.Model=n(10),e.exports=i},function(e,t){"use strict";function n(){this.__obsrvs={}}n.prototype.prop=function(e,t,n){var i;this._isFunc(getter)?(i={get:getter},this._isFunc(n)&&(i.set=n)):i=getter,Object.defineProperty(this,e,i)},n.prototype.watch=function(e,t){if(t)this._watch(e,t);else for(var n in e){var i=e[n];this._watch(n,i)}},n.prototype.unwatch=function(e,t){if(e in this.__obsrvs){var n=this.__obsrvs[e],i=n.indexOf(t);if(-1===i)return;n.splice(i,1)}},n.prototype.cast=function(e,t){if(e in this.__obsrvs){var n=this;n.__obsrvs[e].forEach(function(e){e.call(n,t)})}},n.prototype._watch=function(e,t){e in this.__obsrvs?this.__obsrvs[e].push(t):this.__obsrvs[e]=[t]},n.prototype._callR=function(e,t,n,i){var o=i?this[i]:this;o&&(o=o[n]),o&&o.apply(this,e);var r=this[t];if(r)for(var a in r){var l=r[a];l._callR&&l._callR(e,t,n,i)}},n.prototype._clone=function(e){function t(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}return t(e)},n.prototype._default=function(e,t,n){var i=e||{};return t in i||(i[t]=n),i},n.prototype._isStr=function(e){return"string"==typeof e},n.prototype._isFunc=function(e){return"function"==typeof e},e.exports=n},function(e,t,n){"use strict";function i(e,t,n){var i=this;if(o.call(i),i.__bindedEvents=[],i.embeddable=!1,i.isView=!0,i.views={},i.states={},i.load=function(e){e()},e){if(i._isStr(e)){if(i.id=e,i.el=i._el(e),!i.el)throw new Error("Failed to create View because element not found ID:"+i.id)}else if(e)i.el=e,i.id=e.id;else if(!i.el)throw new Error("Failed to create View because element not specified");jQuery&&(i.$el=jQuery(i.el))}var r=null;if(t){r=t.data,r&&delete t.data;for(var a in t)i[a]=t[a]}if(n){var l={};n.call(i,i,l),i._initEvents(l)}r&&(i.data=r)}var o=n(1),r=n(3);i.extend=function(e){function t(t,n){i.call(this,t,n,e)}return t.prototype=Object.create(this.prototype),t},i.prototype=Object.create(o.prototype,{data:{get:function(){if(null==this._data)return null;if("object"==typeof this._data){var e=this._clone(this._data);for(var t in this.views){var n=this.views[t];n&&(e[t]=n.data)}return e}return this._data},set:function(e){this._data=e,this._render(e)},enumerable:!0,configurable:!1}}),i.prototype.constructor=i,i.prototype.id={},i.prototype.el={},i.prototype.views={},i.prototype.states={},i.prototype.setState=function(e){this.states[e].call(this,this.data)},i.prototype.findEl=function(e){return this.el.querySelector(e)},i.prototype.add=function(e,t){var n=this;n.views[e]=t,t.load(function(){n.el.appendChild(t.el)})},i.prototype.fire=function(e,t){var n=t?new CustomEvent(e,{detail:t,bubbles:!0}):new Event(e,{bubbles:!0});this.el.dispatchEvent(n)},i.prototype._render=function(e){this._embed(e),this._expand(e)},i.prototype._expand=function(e){for(var t in e){var n=e[t];if(t in this.views)this.views[t].data=n;else{var i=this._el(t);if(i)if(n instanceof Object)for(var o in n){var r=n[o];"html"===o?i.innerHTML=r:"value"===o?i.value=r:i.textContent=r}else i.textContent=n}}},i.prototype._embed=function(e){return this.embeddable&&!this.__embedded?(this._walkForReplacingEmbed(this.el,e),this.__embedded=!0,!0):!1},i.prototype._replaceTextEmbed=function(e,t){var n=this;return n._isStr(e)?e.replace(/\{\{(.*?)\}\}/g,function(e,i){return n._embedData(i,t)}):e},i.prototype._replaceURLEmbed=function(e,t){var n=this,i=null,o=0,r=decodeURIComponent(e);return r=r.replace(/\{\{(.*?)\}\}/g,function(e,a,l){var s=n._embedData(a,t);return s.length>9&&s.lastIndexOf("//",9)>-1?i=l:s||(i=r.length),o++,s}),0===o?null:null!=i?r.substr(i):r},i.prototype._embedData=function(e,t){if(!e)return null!=t?t:"";var n=t,i=e.split(".");return i.forEach(function(e){void 0!==n&&(n=n[e])}),null!=n?n:""},i.prototype._walkForReplacingEmbed=function(e,t){var n=this;if(e.nodeType===Node.TEXT_NODE)return void(e.nodeValue=n._replaceTextEmbed(e.nodeValue,t));if(e.nodeType!==Node.PROCESSING_INSTRUCTION_NODE&&e.nodeType!==Node.COMMENT_NODE){["id","name","value","className","alt"].forEach(function(i){e[i]&&(e[i]=n._replaceTextEmbed(e[i],t))}),["href","src"].forEach(function(i){if(e[i]){var o=n._replaceTextEmbed(e.getAttribute(i),t);null!=o&&e.setAttribute(i,o)}});var i=e.childNodes;if(i)for(var o=0,r=i.length;r>o;o++)n._walkForReplacingEmbed(i[o],t);return e}},i.prototype._el=function(e){return document.getElementById(e)},i.prototype._bind=function(e,t,n){"click"===t||"submit"===t?e["on"+t]=n:e.addEventListener(t,n),this.__bindedEvents.push([e,t,n])},i.prototype._initEvents=function(e){for(var t in e){var n=t.lastIndexOf("_");if(-1!=n){var i=t.substr(0,n),o=t.substr(n+1);this._bind(this._el(i),o,e[t])}else this._bind(this.el,t,e[t])}},i.prototype._loadHtml=function(e,t){return(new r).get(e).then(function(e){var n=document.createElement("div");n.innerHTML=e.body,t(n)})},i.prototype._firstElement=function(e){var t=e.firstElementChild;if(void 0!==t)return t;for(var n=e.childNodes,i=0,o=n.length;o>i;i++){var r=n[i];if(r.nodeType===Node.ELEMENT_NODE)return r}return null},i.prototype._destroy=function(){for(var e in this.views){var t=this.views[e];t._destroy()}this.views={},this.__bindedEvents.forEach(function(e){var t=e[1];"click"===t||"submit"===t?e[0]["on"+t]=null:e[0].removeEventListener(t,e[2])}),this.__bindedEvents=[]};var a=0;i.prototype._getLfinId=function(){return"_Lfin_"+a++},e.exports=i},function(e,t){"use strict";function n(e,t,n,i,o){function r(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}var a,l=n||{};if(o){var s=l["Content-Type"];if(s.match(/\/form-data/)){a=new FormData;for(var c in o)a.append(c,o[c])}else a=s.match(/\/json/)?JSON.stringify(o):r(o)}else a=void 0;var u=t;return i&&(u+="?"+r(i)),new Promise(function(t,n){var i=new XMLHttpRequest;i.open(e,u,!0);for(var o in l)i.setRequestHeader(o,l[o]);i.onload=function(e){var n,i=this.getResponseHeader("Content-Type");i.match(/\/json/)?n=JSON.parse(this.response):i.match(/\/form/)?(n={},this.response.split("&").forEach(function(e){var t=e.split("=");n[t[0]]=decodeURIComponent(t[1])})):n=this.response,t({status:this.status,headers:this.getAllResponseHeaders(),body:n})},i.onabort=function(e){n("abort")},i.onerror=function(e){n("error")},i.ontimeout=function(e){n("timeout")},i.send(a)})}function i(e,t){if(this.req=e,"string"==typeof t)this.res=null,this.isTimeout="timeout"===resOrErrType,this.isAborted="abort"===resOrErrType,this.isNetworkError="error"===resOrErrType;else{this.res=t;var n=this.res.status;this.isBadRequest=400===n,this.isForbidden=403===n,this.isUnauthorized=401===n,this.isNotFound=404===n,this.isConflict=409===n,this.isServerError=n>=500}}function o(e){var t=this,o=e||{};t.afterError=function(){},t.authorize=function(){}||o.authorize,t.unauthorized=o.unauthorized||null,t.exec=function(e,r,a,l,s){o.headers=s||{},t.authorize(o.headers,a,l);var c={method:e,path:r,headers:s};return n(e,r,s,a,l).then(function(e){var n=e.status;if(400>n)return e;var o=new i(c,e);return 401===n&&null!=t.unauthorized?void t.unauthorized(o):Promise.reject(o)})["catch"](function(e){return Promise.reject(new i(c,e))})},t.get=function(e,n,i){return t.exec("GET",e,n,null,i)},t.post=function(e,n,i,o,r){var a=r||{};return"Content-Type"in a||(a["Content-Type"]=i||"application/json;charset=UTF-8"),t.exec("POST",e,n,o,a)},t.put=function(e,n,i,o,r){var a=r||{};return"Content-Type"in a||(a["Content-Type"]=i||"application/json;charset=UTF-8"),t.exec("PUT",e,n,o,a)},t.del=function(e,n,i){return t.exec("DELETE",e,n,null,i)}}e.exports=o},function(e,t,n){"use strict";function i(e,t,n){var i=this;i._loadTmpl(e,function(e){var r=document.importNode(e,!0);i.__embedded=!1,t=i._default(t,"embeddable",!0),o.call(i,i._firstElement(r),t,n)})}var o=n(2);i.extend=function(e,t){function n(n){i.call(this,e,n,t)}return n.prototype=Object.create(this.prototype),n.prototype._loadTmpl(e,function(){}),n},i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._render=function(e){this._embed(e)&&this._bindEvts(this.el),this._expand(e)},i.prototype._loadTmpl=function(e,t){if(null==this._tmpl){var n=this;if(e instanceof Node)n._tmpl=e.content;else{if(-1!==e.indexOf(".html",e.length-5))return void n._loadHtml(e,function(e){n._tmpl=n._firstElement(e).content,t(n._tmpl)});n._tmpl=n._el(e).content}}t(this._tmpl)},i.prototype._initEvents=function(e){var t={};for(var n in e){var i=n.lastIndexOf("_");if(-1!==i){var o=n.substr(0,i),r=n.substr(i+1);t[o]={name:r,handler:e[n]}}else this._bind(this.el,n,e[n])}this._evts=t},i.prototype._bindEvts=function(e){var t,n=this._evts;if("FORM"==e.tagName)for(var i in n)t=n[i],this._bind(e[i],t.name,t.handler);else for(var o in n)t=n[o],this._bind(e.querySelector("."+o),t.name,t.handler)},e.exports=i},function(e,t,n){"use strict";function i(e,t,n,i){this._itemSet={},this.itemLoad=function(e,t){},o.call(this,e,n,function(e,n){if(e._isStr(t)){var o=e.el.querySelector("#"+t);e._tmpl=o.content,e._tmplDf=!0,o.parentNode.removeChild(o)}else t?(e._tmpl=t,e._tmplDf=!1):(e._tmpl=null,e._tmplDf=!1);i&&i(e,n)})}var o=n(2),r=n(4);i.extend=function(e,t,n){function o(e){return"function"==typeof e}function r(o,r,a){a=a||{};for(var l in t)l in a||(a[l]=t[l]);i.call(this,o,r||e||null,a,n)}return o(e)?(n=e,t={},e=null):o(t)&&(n=t,t={}),r.prototype=Object.create(this.prototype),r},i.prototype=Object.create(r.prototype,{data:{get:function(){for(var e=[],t=this.el.children,n=0;n<t.length;n++){var i=t[n].getAttribute("LfinId");if(i){var o=this._itemSet[i];o.isView?e.push(o.data):e.push(o)}}return e},set:function(e){this._render(e)}}}),i.prototype.constructor=i,i.prototype.getItemAt=function(e){var t=this.el.children[e],n=t.getAttribute("LfinId");return this._itemSet[n]},i.prototype.addItem=function(e){var t=this,n=t._getLfinId();if(!t._tmplDf){var i=t._tmpl?new t._tmpl({data:e}):e;return t._itemSet[n]=i,t.views[n]=i,i.el.setAttribute("LfinId",n),i.load(function(){t._appendEl(i.el)}),i}var o=t._createFromTmpl(e);t._itemSet[n]=e,o.setAttribute("LfinId",n),t._appendEl(o),t.itemLoad(o,e)},i.prototype.insertItem=function(e,t){var n=this,i=n._getLfinId();if(n._tmplDf){var o=n._createFromTmpl(e);n._itemSet[i]=e,o.setAttribute("LfinId",i),n._insertElBefore(o,n.el.children[t]),n.itemLoad(o,e)}else{var r=n._tmpl?new n._tmpl({data:e}):e;n._itemSet[i]=r,n.views[i]=r,r.el.setAttribute("LfinId",i),r.load(function(){n._insertElBefore(r.el,n.el.children[t])})}},i.prototype.removeItemAt=function(e){var t=this.el.children[e];this.removeItemByEl(t)},i.prototype.removeItemByEl=function(e){var t=e.getAttribute("LfinId");delete this._itemSet[t],delete this.views[t],this._removeEl(e)},i.prototype.removeView=function(e){this.removeItemByEl(e.el)},i.prototype._appendEl=function(e){this.el.appendChild(e),this._bindEvts(e)},i.prototype._insertElBefore=function(e,t){this.el.insertBefore(e,t),this._bindEvts(e)},i.prototype._removeEl=function(e){this.el.removeChild(e)},i.prototype._render=function(e){e||(e=[]);for(var t=this,n=t.el.children,i=n.length-1;i>=0;i--)t.el.removeChild(n[i]);var o={};t._tmplDf?e.forEach(function(e){var n=t._getLfinId(),i=t._createFromTmpl(e);o[n]=e,i.setAttribute("LfinId",n),t._appendEl(i),t.itemLoad(i,e)}):e.forEach(function(e){var n=t._getLfinId(),i=t._tmpl?new t._tmpl({data:e}):e;o[n]=i,i.el.setAttribute("LfinId",n),i.load(function(){t._appendEl(i.el)})}),t._itemSet=o},i.prototype._createFromTmpl=function(e){var t=document.importNode(this._tmpl,!0);return this._walkForReplacingEmbed(t,e),this._firstElement(t)},e.exports=i},function(e,t,n){"use strict";function i(e,t,n){function i(e){t=r._default(t,"embeddable",!0),o.call(r,e,t,n),r._bindEvts()}var r=this;if(e instanceof Node)return void i(e);var a=r._el(e);if(null==a)throw new Error("Not found form root element");i(a)}var o=n(2);i.extend=function(e,t){function n(n,o){for(var r in e)r in o||(o[r]=e[r]);i.call(this,n,o,t)}return void 0===t&&(t=e,e={}),n.prototype=Object.create(this.prototype),n},i.prototype=Object.create(o.prototype,{data:{get:function(){return this._getFields()},set:function(e){this._data=e,this._render(e)}},fields:{get:function(){return this._fields},set:function(e){var t=e;this._isStr(t)&&(t=t.split(/\s+/)),this._fields=t||[]}}}),i.prototype.constructor=i,i.prototype._expand=function(e){this._setFields(e)},i.prototype._getFields=function(){var e=this,t={};return e._fields.forEach(function(n){var i=e.el[n]||e._el(n);if(i)return void(t[n]=i.value);var o=e.views[n];return o?void(t[n]=o.value):void 0}),t},i.prototype._setFields=function(e){var t=this;t._fields.forEach(function(n){if(n in e){var i=e[n]||null,o=t.el[n]||t._el(n);if(o)return void("value"in o?o.value=i:"textContent"in o&&(o.textContent=i||""));var r=t.views[n];return r?void("value"in r?r.value=i:"value"in r.el&&(r.el.value=i)):void 0}})},i.prototype._initEvents=function(e){var t={};for(var n in e){var i=n.lastIndexOf("_");if(-1!==i){var o=n.substr(0,i),r=n.substr(i+1);t[o]={name:r,handler:e[n]}}else this._bind(this.el,n,e[n])}this._evtSet=t},i.prototype._bindEvts=function(){var e,t,n=this,i=this._evtSet;for(var o in i)e=i[o],t=n.el[o]||n._el(o),this._bind(t,e.name,e.handler)},e.exports=i},function(e,t,n){"use strict";function i(e,t,n,i){var r=this;r.box=null,r._ctx=t._ctx,r.parent=t.parent,e instanceof Node?(o.call(r,e,t,n),i&&i.call(r,r)):r._loadHtml(e,function(e){var a=r._el(r.parent.box),l=a.firstElementChild;l?a.replaceChild(e,l):a.appendChild(e),o.call(r,e,t,n),i&&i.call(r,r)})}var o=n(2);i.extend=function(e){var t=function(t,n,o){i.call(this,t,n,e,o)};return t.prototype=Object.create(this.prototype),t},i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.context=function(e,t){if(void 0===t){for(var n=this;null!=n;n=n.parent)if(e in n._ctx)return n._ctx[e]}else this.unloading?this.parent&&(this.parent._ctx[e]=t):this._ctx[e]=t},i.prototype.broadcast=function(e,t){this._callR([e,t],"views","cast")},e.exports=i},function(e,t,n){"use strict";var i=n(7),o=new function(){var e=this;e.PATH_HEAD="#!",e.ID_SEP=":",e.defaultPath="",e.viewDir="views/",e.areas={index:function(){}},e._layers=null,e._preCtx=null,e._hashChanged=!1,e.onhashchange=function(){e._hashChanged=!0,this.location.hash.substr(0,2)==e.PATH_HEAD&&setTimeout(function(){e.load(null,e._preCtx),e._preCtx=null},0)},e.onload=function(){var t=i.extend(e.areas.index),n=new t(document.body,{_ctx:{}});n.box=e._rootBox||null,e._layers=[{name:"",area:n}];var o=window.location.hash;!o&&e.defaultPath?window.location.hash=e.PATH_HEAD+e.defaultPath:o&&e.load()},e.config=function(t,n){e._layers?e._layers[0].area.box=t:e._rootBox=t,e.defaultPath=n||e.defaultPath,window.onhashchange=e.onhashchange,window.onload=e.onload},e.broadcast=function(t,n){e._layers.forEach(function(e){e.area.broadcast(t,n)})},e.leafArea=function(){var t=e._layers;return t[t.length-1].area},e.addLayer=function(t,n){e._layers.push({name:t.name,id:t.id,area:n})},e.dropLayers=function(t){var n=0,i=e._layers;if(1==i.length)return 1;for(;n<i.length-1&&n<t.length;){if(i[n+1].name!=t[n].name){n++;for(var o=i.splice(n,i.length-n),r=o.length-1;r>=0;r--){var a=o[r].area;a.unloading=!0,a.unload&&a.unload(),a._destroy(),a.parent=null}return n}if(++n===i.length)return n}return null},e.go=function(t,n,i){if(i)e.load(t,n);else{e._preCtx=n;var o=window.location.hash;window.location.hash=e.PATH_HEAD+t,!e._hashChanged&&o&&(e._hashChanged=!1,e.load(null,e._preCtx),e._preCtx=null)}},e.back=function(){return window.history.back(),!1},e.load=function(t,n){var i,o=window.location.hash;i=t?t:o&&o.substr(0,e.PATH_HEAD.length)==e.PATH_HEAD?o.substr(2):e.defaultPath,i=e._parsePath(i);var r=e.dropLayers(i);if(null==r){var a=e.leafArea();return a.context("id",i[i.length-1].id),n&&e._merge(a._ctx,n),void(a.load&&a.load(function(){}))}var l=i,s=function(t){var i=t===l.length;e._loadArea(l.slice(0,t),i?n:null,function(){i||s(t+1)})};s(r)},e._snakeToCamel=function(e){return e.replace(/(\-\w)/g,function(e){return e[1].toUpperCase()})},e._parsePath=function(t){return t.split("/").map(function(t){var n=t.split(e.ID_SEP);return 2===n.length?{name:n[0],id:n[1]}:{name:n[0]}})},e._loadArea=function(t,n,o){var r=t[t.length-1],a=function(){var n=e.areas;return t.forEach(function(t){var i=e._snakeToCamel(t.name);n=n[i]}),void 0===n?function(){}:"function"==typeof n?n:n.index}(),l={parent:e.leafArea(),_ctx:{id:r.id}},s=e.viewDir+t.map(function(e){return e.name}).join("/")+".html";n&&e._merge(l._ctx,n);var c=new i(s,l,a,function(t){t.load?t.load(o):o(),e._loadSubview(t)});e.addLayer(r,c)},e._loadSubview=function(t){var n=t.views;for(var i in n){var o=n[i];o.load?o.load(function(){e._loadSubview(o)}):e._loadSubview(o)}},e._merge=function(e,t){for(var n in t)e[n]=t[n]}};e.exports=o},function(e,t){"use strict";function n(e,t){this._key=e,this._expires=1e3*(t||120)}var i={_key:null,_expires:5e3,_listCache:{expires:0},_setCache:{},get now(){return(new Date).getTime()},get expires(){return(new Date).getTime()+this._expires},getAll:function(){var e=this;if(e.now>=e._listCache.expires)return null;var t=[];return e._listCache.data.some(function(n){var i=e.get(n);return null===i?!0:(t.push(i),!1)}),t.length<e._listCache.data.length?null:t},get:function(e){var t=this._setCache[e];return t?this.now<t[1]?t[0]:(delete this._setCache[e],null):null},setAll:function(e,t){var n=this.expires,i=this._setCache={},o=[];t.forEach(function(t){var r=t[e],a=[t,n];i[r]=a,o.push(r)}),this._listCache={data:o,expires:n}},set:function(e,t){this._setCache[e]=[t,this.expires]},del:function(e){delete this._setCache[e]}};n.prototype=Object.create(i),n.prototype.constructor=n,e.exports=n},function(e,t,n){"use strict";function i(e,t){this._defineProps=null,this.rootPath=e;var n=t||{};this.idField=n.idField||"id",this.dataField=n.dataField||null,this.cache=n.cache||null}var o=n(1),r=n(3);i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._path=function(e){return this.rootPath.replace(/\:(\w+)/g,function(t,n){return e[n]})},i.prototype.all=function(e){var t=this,n=e||{};if(t.cache&&!n.force){var i=t.cache.getAll();if(i)return Promise.resolve(i)}var o=new r;return o.get(n.path||t._path(n),n.query||null,n.headers||null).then(function(e){var n,i=e.body,o={};if(t.dataField){n=i[t.dataField],delete i[t.dataField];for(var r in i)o[r]=i[r]}else n=i;var a=n.map(function(e){return t.toEntity(e)});return o.items=a,t.cache&&t.cache.setAll(t.idField,a),o})},i.prototype.find=function(e,t){var n,i,o,a=this,l=new r;if(a._isStr(e)?(i=t||{},n=a._path(i)+"/"+e,o=e):(i=e||{},n=a._path(i),o="__SELF__"),a.cache&&!i.force){var s=a.cache.get(o);if(s)return Promise.resolve(s)}return l.get(n,i.query||null,i.headers||null).then(function(e){var t=e.body,n=a.toEntity(t);return a.cache&&a.cache.set(o,n),n})["catch"](function(e){return e&&e.isNotFound?Promise.resolve(null):Promise.reject(e)})},i.prototype.create=function(e,t){var n=this,i=t||{},o=new r;return o.post(n._path(i),i.query||null,null,e,i.headers||null).then(function(e){var t=e.body;return n.cache&&n.cache.set(t[n.idField],t),t})},i.prototype.update=function(e,t,n){var i,o,a,l,s=this,c=new r;return s._isStr(e)?(a=n||{},o=t,i=s._path(a)+"/"+e,l=e):(a=t||{},o=e,i=s._path(a),l="__SELF__"),c.put(i,a.query||null,null,o,a.headers||null).then(function(e){var t=e.body;return s.cache&&s.cache.set(l,t),t})},i.prototype.destroy=function(e,t){var n,i,o,a=this,l=new r;return a._isStr(e)?(i=t||{},n=a._path(i)+"/"+e,o=e):(i=e||{},n=a._path(i),o="__SELF__"),l.del(n,i.query||null,i.headers||null).then(function(e){return a.cache&&a.cache.del(o),null})},i.prototype.defProp=function(e,t,n){this._defProps=this._defProps||{};var i={configurable:!1,get:t};n&&(i.set=n),this._defProps[e]=i},i.prototype.defMethod=function(e,t){var n=this;n[e]=function(e){return t.apply(n,[e])}},i.prototype.save=function(){var e=this.__model;if(!e)throw new Error("Need to call from entity");if(e.idField in this){var t=this[e.idField];return e.update(t,this)}return e.create(this)},i.prototype.toEntity=function(e){var t;return t=this._defProps?Object.create(e,this._defProps):e,Object.defineProperty(e,"__model",this),Object.defineProperty(e,"save",{value:this.__proto__.save}),t},e.exports=i}])})},function(e,t,n){var i=n(1),o=i.App,r=n(3),a=n(4),l=n(9),s=i.ListView.extend(function(e,t){e.newArrival=new r,e.newArrival.watch("clear",function(){for(var t in e.views)e.views[t].clearNewArrival()}),function(t){t.indexOf("windows")>-1&&-1===t.indexOf("phone")&&-1===t.indexOf("touch")&&(e.el.className="windowsScroller")}(window.navigator.userAgent.toLowerCase());var n=document.documentElement.clientWidth;if(n>440)e.$el.addClass("bounding");else{var i,o,a=0,l=0,s=0;t.touchstart=function(){i=l=event.touches[0].pageX,o=s=event.touches[0].pageY},t.touchmove=function(){var e=event.touches[0].pageX,t=event.touches[0].pageY;return 0>s||Math.abs(t-s)>Math.abs(e-l)/2?void(s=-1):(this.scrollLeft+=i-e,i=e,void(o=t))},t.touchend=function(){return-1===s?void e.$el.animate({scrollLeft:a*n},120):(Math.abs(i-l)>=30&&(i>l?this.scrollLeft>0&&a--:this.scrollLeft<this.scrollWidth-n&&a++),void(this.scrollLeft!==a*n&&e.$el.animate({scrollLeft:a*n},80)))}}}),c=function(e,t){e.load=function(t){var n=e.data;n.width&&e.$el.addClass(n.width),t()},e.applyEvents=function(){var t=e.findEl(".timelineBody");$(".timeline > header",e.el).click(function(e){$(t).animate({scrollTop:0})})},e.clearNewArrival=function(){e.$el.find("> .timeline > header").removeClass("newArrival"),e.$el.find("> .timeline > .timelineBody > div").removeClass("newArrival")}},u={};u.deck=function(e,t){var n=i.TemplateView.extend("deckColumn",c),r=new s("deck",null,null),u=[];e.load=function(e){var t=localStorage.getItem("timelines");return t=t?JSON.parse(t):[],0===t.length?(e(),void o.go("intro")):(window.history.replaceState({},document.title,window.location.pathname),t.forEach(function(e){var t=new n({data:{width:e.width}});r.addItem(t);var i;"backlog"==e.service?i=a:"github"==e.service&&(i=l),i.loadActivities(t,r.newArrival,e,function(e,n){u.push(e),t.applyEvents()})}),void e())},e.unload=function(){u.forEach(function(e){e.stopAutoLoad()}),u=[]}},u.demo=function(e,t){var n=i.TemplateView.extend("deckColumn",c),r=new s("deck",null,null),u=0;e.load=function(t){var i=[{service:"github",width:"wide",notify:"off",kind:"public_timeline",caption:"Public Timeline",token:null,endpoint:null},{service:"github",width:"narrow",notify:"off",kind:"repo",owner:"facebook",repo:"react",caption:"facebook/react",token:null,endpoint:null},{service:"github",width:"normal",notify:"off",kind:"org",org:"microsoft",caption:"microsoft",token:null,endpoint:null},{service:"github",width:"normal",notify:"off",kind:"org",org:"google",caption:"google",token:null,endpoint:null}],s=[];i.forEach(function(e){var t=new n({data:{width:e.width}});r.addItem(t);var i;"backlog"==e.service?i=a:"github"==e.service&&(i=l),i.loadActivities(t,r.newArrival,e,function(e,n){t.applyEvents(),s.push(e)})}),e.stop=function(){s.forEach(function(e){e.stopAutoLoad()})},u=setTimeout(function(){e.stop(),alert("Demo exiting and return introduction page"),o.go("intro")},12e4),t()},e.unload=function(){e.stop(),u&&clearTimeout(u)}},u.intro=function(e,t){window.history.replaceState({},document.title,window.location.pathname)},e.exports=u},function(e,t,n){function i(){var e=this;o.Core.call(e),e.watch("notify",function(t){if(!e.hasNewArrival&&t.notify){var n=document.querySelector("#favicon");e.hasNewArrival=!0,n.href="img/favicon-new.ico",document.body.addEventListener("click",function(t){e.cast("clear"),document.body.removeEventListener("click",arguments.callee,!1)})}if("notify"in t&&"off"!==t.notify&&"Notification"in window&&"granted"===Notification.permission){var i;if(t.mentions)i="Your are mentioned "+t.message;else{if("mentioned"===t.notify)return;i=t.message}var o=new Notification(t.title,{body:i,icon:"img/apple-touch-icon-180x180.png"});o.onclick=function(){window.focus()},setTimeout(o.close.bind(o),6e3)}}),e.watch("clear",function(t){var n=document.querySelector("#favicon");n.href="img/favicon-default.ico",e.hasNewArrival=!1})}var o=n(1);i.prototype=Object.create(o.Core.prototype),e.exports=i},function(e,t,n){var i=n(1),o=n(5),r=n(7),a=i.TemplateView.extend("views/backlog.html",function(e,t){var n=new r(e.model.rootUrl,function(t){return e.findEl("#"+t)}),o=i.TemplateView.extend(e.findEl("#BacklogItem"),function(e,t){e.load=function(t){e.add("item",n.createView(e.data)),e.data.newArrival&&e.$el.addClass("newArrival"),t()}}),a=new i.ListView(e.findEl(".timelineBody"),o);e.views.eventList=a,e.loadMore=function(t){e.destroyed()||(t.reverse().forEach(function(e){e.newArrival=!0,a.insertItem(e,0)}),e.$el.find("> header").addClass("newArrival"))},e.destroyed=function(){return!e.el.parentNode}});t.loadActivities=function(e,t,n,i){var r={token:n.token,endpoint:n.endpoint},l=new o(r.token,r.endpoint);l.activate(n).then(function(n){var o=new a(n);l.watch("newArrived",function(e){e.notify&&t.cast("notify",e.notify),e.newItems.length>0&&o.loadMore(e.newItems)}),e.add("timeline",o),i(l,o)}).fail(function(){alert("Can't fetch Backlog information")})}},function(e,t,n){function i(e,t){o.Core.call(this),this.client=new r(e,t),this.rootUrl=t,this.latestId=0}var o=n(1),r=n(6);i.prototype=Object.create(o.Core.prototype),i.prototype.activate=function(e){var t=this;t.tlinfo=e,t.interval=6e4;var n=e.project;return t.fetchPath="/api/v2/"+("space"==n?"space":"projects/"+n)+"/activities",t.webUrl=this.rootUrl+("space"==n?"/dashboard":"/projects/"+n),t.client.fetch({path:t.fetchPath,count:40}).then(function(n){t.latestId=n.length>0?parseInt(n[0].id,10):0;var i={name:e.caption,url:t.webUrl,eventList:n,notify:e.notify||"off"};return setTimeout(function(){t.loadNew()},t.interval),{model:t,data:i,name:i.name,notify:i.notify||"off"}})},i.prototype.loadNew=function(){var e=this;return 0===e.interval?!1:void e.client.fetch({path:e.fetchPath,minId:e.latestId+1}).then(function(t){for(var n,i=0,o=0,r=t.length;r>o&&(n=parseInt(t[o].id,10),!(n<=e.latestId));o++)i++;var a=null;i>0&&(e.latestId=t.length>0?parseInt(t[0].id,10):0,a={notify:e.tlinfo.notify||"off",title:"Backlog "+e.tlinfo.caption,message:i+" new event(s)"}),e.interval>0&&setTimeout(function(){e.loadNew()},e.interval),e.cast("newArrived",{newItems:t.slice(0,i),notify:a})})},i.prototype.stopAutoLoad=function(){this.interval=0},e.exports=i},function(e,t){function n(e,t){this.token=e,this.rootUrl=t}n.prototype.loadProjects=function(e){var t=jQuery.Deferred();return jQuery.ajax({url:this.rootUrl+"/api/v2/projects",data:{apiKey:this.token},dataType:"json"}).done(function(e){t.resolve(e.filter(function(e){return!e.archived}))}).fail(function(e){console.log(e),t.reject(e)}),t},n.prototype.fetch=function(e,t){var n={apiKey:this.token};e.latestId&&(n.minId=e.latestId+1),e.count&&(n.count=e.count);var i=jQuery.Deferred();return jQuery.ajax({url:this.rootUrl+e.path,data:n,dataType:"json"}).done(function(e){i.resolve(e.filter(function(e){return!e.archived}))}).fail(function(e){console.log(e),i.reject(e)}),i},e.exports=n},function(e,t,n){function i(e,t){this.rootUrl=e,this.views=o(t)}function o(e){var t={};return t.EventView=a.TemplateView.extend(e("BacklogEvent"),function(e,t){e.views.changes=new a.ListView(e.findEl(".issueChanges"),"issueChange"),e.views.attachments=new a.ListView(e.findEl(".issueAttachments"),"imageAttachment"),e.load=function(t){var n=e.findEl(".commentBody"),i=e.data.diff;i?n.innerHTML=marked(i.newValue):n.innerHTML=marked(e.data.desc||""),t()}}),t.FileView=a.TemplateView.extend(e("BacklogFileEvent")),t.WikiView=a.TemplateView.extend(e("BacklogWikiEvent"),function(e,t){e.load=function(t){var n=e.findEl(".commentBody");n.innerHTML=marked(e.data.diff||""),t()}}),t.JoinView=a.TemplateView.extend(e("BacklogJoinEvent")),t.GitPushView=a.TemplateView.extend(e("BacklogGitPushEvent"),function(e,t){e.views.commits=new a.ListView(e.findEl(".pushCommits"),"pushCommit")}),t}var r=n(8),a=n(1);i.prototype={Wiki:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:r(e.created),actor:e.createdUser,project:e.project,file:e.content.name,diff:e.content.diff||e.content.content};return new this.views.WikiView({data:t})},File:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:r(e.created),actor:e.createdUser,project:e.project,file:e.content.dir+e.content.name};return new this.views.FileView({data:t})},Join:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:r(e.created),actor:e.createdUser,project:e.project,move:15==e.type?"に加わりました。":"から外れました。",users:e.content.users.map(function(e){return e.name}).join(", ")};return new this.views.JoinView({data:t})},GitPush:function(e){function t(e,t){return t.map(function(t){return{sha:t.rev.substr(0,6),commitUrl:e+"/commit/"+t.rev,message:t.comment}})}var n={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:r(e.created),actor:e.createdUser,project:e.project,projectKey:e.project.projectKey,repoName:e.content.repository.name},i=this.rootUrl+"/git/"+n.projectKey+"/"+n.repoName;return n.repoUrl=i,n.branch=e.content.ref.replace(/^refs\/heads\//,""),n.branchUrl=i+"/tree/"+n.branch,n.commits=t(i,e.content.revisions),new this.views.GitPushView({data:n})},Event:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:r(e.created),actor:e.createdUser,project:e.project,projectKeyId:e.project.projectKey+"-"+e.content.key_id,summary:e.content.summary,desc:e.content.description};return this.analyzeChanges(t,e.content.changes),e.content.attachments&&(t.attachments=this.convertAttachments(this.rootUrl,e.content.attachments)),t.url=this.rootUrl+"/view/"+t.projectKeyId,e.content.comment&&(t.desc=e.content.comment.content),new this.views.EventView({data:t})},typeCaption:[null,"課題の追加","課題の更新","課題にコメント","課題の削除","Wikiを追加","Wikiを更新","Wikiを削除","共有ファイルを追加","共有ファイルを更新","共有ファイルを削除","Subversionコミット","GITプッシュ","GITリポジトリ作成","課題をまとめて更新","プロジェクトに参加","プロジェクトから脱退","コメントにお知らせを追加","プルリクエストの追加","プルリクエストの更新","プルリクエストにコメント"],statuses:[null,"未対応","処理中","処理済み","完了"],resolutions:["対応済み","対応しない","無効","重複"],priorities:[null,null,"高","中","低"],convertChange:function(e){var t;return"status"==e.field?t={field:"状態",newValue:this.statuses[parseInt(e.new_value)],mark:"→",oldValue:this.statuses[parseInt(e.old_value)]}:"resolution"==e.field?t={field:"完了理由",newValue:this.resolutions[parseInt(e.new_value)],mark:"→",oldValue:this.resolutions[parseInt(e.old_value)]}:"priority"==e.field?t={field:"優先度",newValue:this.priorities[parseInt(e.new_value)],mark:"→",oldValue:this.priorities[parseInt(e.old_value)]}:"attachment"==e.field?t={field:"添付ファイル",newValue:e.new_value,mark:"",oldValue:e.old_value}:"assigner"==e.field?t={field:"担当",oldValue:e.old_value,mark:"→",newValue:e.new_value}:"description"==e.field?t={field:"diff",oldValue:e.old_value,mark:"→",newValue:e.new_value}:"limitDate"==e.field?t={field:"期限日",oldValue:e.old_value,mark:"→",newValue:e.new_value}:"issueType"==e.field&&(t={field:"種別",
oldValue:e.old_value,mark:"→",newValue:e.new_value}),t?t.oldValue||(t.mark=""):t={},t},analyzeChanges:function(e,t){if(t){var n=this;e.changes=[],t.forEach(function(t){var i=n.convertChange(t);"diff"==i.field?e.diff=i:e.changes.push(i)})}},convertAttachments:function(e,t){var n=[];return t.forEach(function(t){try{var i=t.name,o=i.substr(i.lastIndexOf(".")+1).toLowerCase();"png"!=o&&"jpg"!=o&&"gif"!=o||n.push({imageUrl:e+"/ViewAttachmentImage.action?attachmentId="+t.id,id:t.id,name:i,size:t.size})}catch(r){}}),n},createView:function(e){switch(e.type){case 5:case 6:case 7:return this.Wiki(e);case 12:return this.GitPush(e);case 8:case 9:case 10:case 11:case 13:return this.File(e);case 15:case 16:return this.Join(e);default:return this.Event(e)}}},e.exports=i},function(e,t){e.exports=function(e){var t=(new Date).getTime(),n=new Date(e),i=n.getHours(),o=n.getMinutes();return 10>i&&(i=" "+i),10>o&&(o="0"+o),t-n.getTime()<432e5?i+":"+o:n.getMonth()+1+"."+n.getDate()+" "+i+":"+o}},function(e,t,n){var i=n(1),o=n(10),r=n(11),a=i.TemplateView.extend("views/github.html",function(e,t){var n=new r(e.model.webUrl,function(t){return e.findEl("#"+t)}),o=i.TemplateView.extend(e.findEl("#GitHubItem"),function(e,t){e.load=function(t){var i=n.createView(e.data);i&&(e.add("item",i),e.data.newArrival&&e.$el.addClass("newArrival")),t()}}),a=new i.ListView(e.findEl(".timelineBody"),o);e.views.eventList=a,e.loadMore=function(t){e.destroyed()||(t.reverse().forEach(function(e){e.newArrival=!0,a.insertItem(e,0)}),e.$el.find("> header").addClass("newArrival"))},e.destroyed=function(){return!e.el.parentNode}});t.loadActivities=function(e,t,n,i){var r={token:n.token,endpoint:n.endpoint};r.endpoint&&r.endpoint.match(/^https?\:\/\/github\.com\/?$/)&&(r.endpoint=null);var l=new o(r.token,r.endpoint);l.activate(n).then(function(n){var o=new a(n);l.watch("newArrived",function(e){e.notify&&t.cast("notify",e.notify),e.newItems.length>0&&o.loadMore(e.newItems)}),e.add("timeline",o),i(l,o)}).fail(function(){alert("Can't fetch GitHub information")})}},function(e,t,n){function i(e,t){o.Core.call(this);var n={token:e};t&&(n.rootURL=t+"/api/v3"),this.octo=new Octokat(n),this.loginUser=null,this.fetcher=null,this.latestId=0,this.isPublic=!e,this.webUrl=t||"https://github.com"}var o=n(1);i.prototype=Object.create(o.Core.prototype),i.prototype.activate=function(e){var t=this;t.tlinfo=e,t.interval=6e4;var n=t.isPublic?jQuery.Deferred().resolve(null):t.octo.me.fetch();return n.then(function(n){return t.loginUser=n||null,"my_timeline"==e.kind?(t.fetcher=t.octo.users(n.login).receivedEvents,e.value=n.login):"org"==e.kind?t.fetcher=t.octo.orgs(e.org).events:"repo"==e.kind?t.fetcher=t.octo.repos(e.owner,e.repo).events:"private"==e.kind?t.fetcher=t.octo.users(n.login).events.orgs(e.value):"public_timeline"==e.kind&&(t.fetcher=t.octo.events,e.value="Public"),t.fetcher.fetch({per_page:60})}).then(function(n){t.latestId=n.length>0?parseInt(n[0].id,10):0;var i=(t.applyMention(n),{name:e.caption,url:"https://github.com/"+e.value,eventList:n,notify:e.notify||"off"});return setTimeout(function(){t.loadNew()},t.interval),{model:t,data:i,name:i.name,notify:i.notify||"off"}})},i.prototype.loadNew=function(){var e=this;return 0===e.interval?!1:void e.fetcher.fetch().then(function(t){for(var n,i=0,o=0,r=t.length;r>o&&(n=parseInt(t[o].id,10),!(n<=e.latestId));o++)i++;if(e.interval>0&&setTimeout(function(){e.loadNew()},e.interval),0!==i){e.latestId=t.length>0?parseInt(t[0].id,10):0;var a=t.slice(0,i),l=e.applyMention(a),s={notify:e.tlinfo.notify||"off",title:"GitHub "+e.tlinfo.caption,message:i+" new event(s)",mentions:l};e.cast("newArrived",{newItems:a,notify:s})}})},i.prototype.stopAutoLoad=function(){this.interval=0};const r=["issue","comment","pullRequest"];i.prototype.applyMention=function(e){var t=0,n="@"+this.loginUser.login;return e.forEach(function(e){var i=e.payload;return i.body&&i.body.indexOf(n)>-1?(e.mention=!0,void t++):void r.some(function(o){return i[o]&&i[o].body&&i[o].body.indexOf(n)>-1?(e.mention=!0,t++,!0):void 0})}),t},e.exports=i},function(e,t,n){function i(e,t){this.rootUrl=e,this.views=o(t)}function o(e){var t={};return t.CommitCommentView=s.TemplateView.extend(e("CommitCommentEvent"),function(e,t){e.load=function(t){e.data.comment.diffHunk&&(e.findEl(".diffBody").innerHTML=r(e.data.comment.diffHunk)),e.findEl(".commentBody").innerHTML=a(e.data.comment.body||""),t()}}),t.CreateView=s.TemplateView.extend(e("CreateEvent")),t.ForkView=s.TemplateView.extend(e("ForkEvent")),t.IssuesView=s.TemplateView.extend(e("IssuesEvent"),function(e,t){e.load=function(t){var n=e.findEl(".issueBody");"opened"==e.data.action?(n.innerHTML=a(e.data.body||""),e.data.mention&&$(n).addClass("mentioned")):e.el.removeChild(n),t()}}),t.IssueCommentView=s.TemplateView.extend(e("IssueCommentEvent"),function(e,t){var n=e.findEl(".issueBody");$(n).click(function(){$(this).toggleClass("full")}),e.load=function(t){if(e.data.comment.body){e.data.issue.body&&(n.innerHTML=a(e.data.issue.body),e.data.mention&&$(n).addClass("mentioned"));var i=e.findEl(".commentBody");i.innerHTML=a(e.data.comment.body||""),e.data.mention&&$(i).addClass("mentioned")}else if(null!=e.data.issue.labels){var o=e.data.issue.labels[0];n.innerHTML='<span style="background-color:#'+o.color+'">'+o.name+"</span>"}else console.log(e.data.issue);t()}}),t.MemberView=s.TemplateView.extend(e("MemberEvent")),t.PublicView=s.TemplateView.extend(e("PublicEvent")),t.PullRequestView=s.TemplateView.extend(e("PullRequestEvent"),function(e,t){e.load=function(t){var n=e.findEl(".pullReqBody");"closed"!==e.data.action?e.data.pullRequest.body&&(n.innerHTML=a(e.data.pullRequest.body||""),e.data.mention&&$(n).addClass("mentioned")):e.el.removeChild(n),t()}}),t.PullRequestReviewCommentView=s.TemplateView.extend(e("PullRequestReviewCommentEvent"),function(e,t){var n=e.findEl(".issueBody");$(n).click(function(){$(this).toggleClass("full")}),e.load=function(t){e.findEl(".diffBody").innerHTML=r(e.data.comment.diffHunk);var n=e.findEl(".commentBody");n.innerHTML=a(e.data.comment.body||""),e.data.mention&&$(n).addClass("mentioned"),t()}}),t.ReleaseView=s.TemplateView.extend(e("ReleaseEvent")),t.WatchView=s.TemplateView.extend(e("WatchEvent")),t.PushView=s.TemplateView.extend(e("PushEvent"),function(e,t){e.views.commits=new s.ListView(e.findEl(".pushCommits"),"pushCommit",null,function(e,t){e.itemLoad=function(e,t){$(".msg",e).click(function(){$(this).toggleClass("expanded")})}})}),t.GollumView=s.TemplateView.extend(e("GollumEvent"),function(e,t){e.views.pages=new s.ListView(e.findEl(".gollumPageUpdates"),"gollumPageUpdate")}),t}function r(e){for(var t=e.split("\n"),n=['<p class="head">'+t[0]+"</p>"],i=1,o=t.length;o>i;i++){var r=t[i].charAt(0);"+"===r?n.push('<p class="plus">'+t[i]+"</p>"):"-"===r?n.push('<p class="minus">'+t[i]+"</p>"):n.push('<p class="normal">'+t[i]+"</p>")}return n.join("")}function a(e){return marked(e,{renderer:c})}var l=n(8),s=n(1);i.prototype={createView:function(e){return e.type in this?this[e.type](e):null},CommitCommentEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=t.comment.user,t.repo=e.repo,t.sha=t.comment.commitId.substr(0,6),t.comment.createdAt=l(t.comment.createdAt),new this.views.CommitCommentView({data:t})},CreateEvent:function(e){var t=e.payload;if("repository"===t.refType)return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.repo.rootUrl="https://github.com",t.createdAt=l(e.createdAt),t.octicon="repo",new this.views.CreateView({data:t})},ForkEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=l(e.createdAt),new this.views.ForkView({data:t})},GollumEvent:function(e){function t(e,t){return t.map(function(t){return{sha:t.sha.substr(0,6),action:t.action,octicon:"created"===t.action?"book":"pencil",title:t.title,htmlUrl:e+t.htmlUrl}})}var n=e.payload;return n.rootUrl=this.rootUrl,n.actor=e.actor,n.repo=e.repo,n.createdAt=l(e.createdAt),n.pages=t("https://github.com",n.pages),new this.views.GollumView({data:n})},IssuesEvent:function(e){var t=e.payload.issue;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.octicon="issue-"+e.payload.action,t.action=e.payload.action,t.actor=e.actor,t.repo=e.repo,t.createdAt=l(e.createdAt),new this.views.IssuesView({data:t})},IssueCommentEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.octicon=t.issue.pullRequest?"git-pull-request":"issue-opened",t.createdAt=l(e.createdAt),t.comment.createdAt=l(t.comment.createdAt),new this.views.IssueCommentView({data:t})},MemberEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=l(e.createdAt),new this.views.MemberView({data:t})},PublicEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=l(e.createdAt),new this.views.PublicView({data:t})},PullRequestEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=l(e.createdAt),t.pullRequest.createdAt=l(t.pullRequest.createdAt),"opened"==t.action?t.octicon="git-pull-request":"closed"==t.action&&t.pullRequest.merged?(t.action="merged",t.octicon="git-merge"):t.octicon="circle-slash",new this.views.PullRequestView({data:t})},PullRequestReviewCommentEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=l(e.createdAt),t.comment.createdAt=l(t.comment.createdAt),new this.views.PullRequestReviewCommentView({data:t})},PushEvent:function(e){function t(e,t){return t.map(function(t){return{sha:t.sha.substr(0,6),commitUrl:e+"/commit/"+t.sha,message:t.message}})}var n=e.payload;return n.rootUrl=this.rootUrl,n.branch=n.ref.replace(/^refs\/heads\//,""),n.shortSha=n,n.actor=e.actor,n.repo=e.repo,n.commits=t(this.rootUrl+"/"+n.repo.name,n.commits),n.createdAt=l(e.createdAt),new this.views.PushView({data:n})},ReleaseEvent:function(e){console.log(e);var t=e.payload.release;return t.rootUrl=this.rootUrl,t.repo=e.repo,t.createdAt=l(t.publishedAt),new this.views.ReleaseView({data:t})},WatchEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=l(e.createdAt),new this.views.WatchView({data:t})}};var c=new marked.Renderer;c.heading=function(e,t,n){return"<h"+t+">"+e+"</h"+t+">\n"},e.exports=i},function(e,t,n){var i=n(1),o=i.App,r={};r.github=n(13),r.backlog=n(16),r.index=function(e,t){e.box="subContentBox"},r.timeline=function(e,t){var n=i.TemplateView.extend("column",function(e,t){t.remove_click=function(){e.$el.fadeOut(300,function(){e.$el.remove()})},t.moveLeft_click=function(){e.fire("move",{pos:-1,el:this.parentElement.parentElement})},t.moveRight_click=function(){e.fire("move",{pos:1,el:this.parentElement.parentElement})},t.widthSelect_change=function(){e._data.width=this.value},t.notifySelect_change=function(){e._data.notify=this.value},e.load=function(t){e.findEl(".widthSelect").value=e._data.width,e.findEl(".notifySelect").value=e._data.notify||"off",e.findEl(".project").innerHTML=e._data.caption.split("/").join("/<wbr>"),t()}}),r=e.views.showcase=new i.ListView("showcase",n,null,function(e,t){t.move=function(t){var n=t.detail;if(n.pos>0){var i=n.el.nextElementSibling;i&&(e._removeEl(n.el),e.el.insertBefore(n.el,i.nextElementSibling))}else{var o=n.el.previousElementSibling;o&&(e._removeEl(n.el),e.el.insertBefore(n.el,o))}}});e.load=function(t){var n=e.context("timelines"),i=e.context("newTimeline");if(n)i&&n.push(i);else{var n;try{var o=localStorage.getItem("timelines");n=o?JSON.parse(o):[]}catch(a){n=[]}e.context("timelines",n)}r.data=n,t()},e.unload=function(){var t=r.data;if(e.needSave){localStorage.setItem("timelines",JSON.stringify(t));var n=t.some(function(e){return"off"!=e.notify});n&&"Notification"in window&&Notification.requestPermission()}else e.context("timelines",t)},t.cancelButton_click=function(){e.needSave=!1,o.go("setting/list")},t.saveButton_click=function(){e.needSave=!0,o.go("deck")}},r.port=function(e,t){t.importButton_click=function(){try{var t=JSON.parse(e.el.querySelector("#snippet").value);t.timelines?(localStorage.setItem("defaults",JSON.stringify(t.defaults)),localStorage.setItem("timelines",JSON.stringify(t.timelines)),o.go("deck")):alert("Invalid data")}catch(n){alert("Invalid JSON format")}return!1},t.exportButton_click=function(){var t=localStorage.getItem("defaults");return timelines=localStorage.getItem("timelines"),e.el.querySelector("#snippet").value='{"defaults":'+t+',"timelines":'+timelines+"}",!1},t.snippet_focus=function(){this.select()}},e.exports=r},function(e,t,n){var i=n(1),o=n(14),r=n(15),a=i.App;e.exports=function(e,t){var n,l={},s=e.views.accountForm=new i.FormView("accountForm",{fields:"githubToken gheUrl"},function(e,t){var r=new i.ListView("githubTimelineSelect","githubTimelineItem");t.submit=function(t){var i=e.findEl('input[name="gheUrl"]');i.value=i.value.replace(/\/$/,"");var a=e.data;return l={token:a.githubToken,gheUrl:a.gheUrl},n=new o(l.token,l.gheUrl),n.activate().then(function(e){var t=[{caption:"My Timeline",value:"my_timeline"}];e.orgs.forEach(function(e){t.push({caption:e.login,value:e.login})}),r.data=t,$("fieldset",u.el).removeAttr("disabled"),$("fieldset",d.el).removeAttr("disabled"),$("fieldset",f.el).removeAttr("disabled")}).fail(function(e){r.data=[],$("fieldset",u.el).attr("disabled","disabled"),$("fieldset",d.el).attr("disabled","disabled"),$("fieldset",f.el).attr("disabled","disabled"),l=null,alert("Failed to authenticate GitHub account by token")}),!1}}),c=function(e,t){t.token=l.token||null,t.endpoint=l.gheUrl||null,t.service="github",t.width="normal",t.caption=t.value;var n=t.value.split("/");1===n.length?(t.org=n[0],t.kind="org"):(t.owner=n[0],t.repo=n[1],t.kind="repo"),p(l),a.go("setting/timeline",{newTimeline:t})},u=e.views.repositoryForm=new i.FormView("repositoryForm",{fields:"value"},function(e,t){t.submit=function(t){var i=e.data,o=i.value.split("/"),r=o[0],a=o.length>1?o[1]:null;return n.fetchTarget(r,a).then(function(t){c(e,e.data)}).fail(function(e){alert("Failed to access repository")}),!1}}),d=e.views.timelineForm=new i.FormView("yourTimelineForm",{fields:"value"},function(e,t){t.submit=function(){var t=e.data;return t.token=l.token||null,t.endpoint=l.gheUrl||null,t.service="github",t.width="normal",t.notify="off","my_timeline"!==t.value?(t.kind="private",t.caption=t.value):(t.kind="my_timeline",t.caption="My Timeline"),p(l),a.go("setting/timeline",{newTimeline:t}),!1}}),f=e.views.publicTimelineForm=new i.FormView("publicTimelineForm",{fields:"value"},function(e,t){t.submit=function(){var e={service:"github",width:"normal",notify:"off",kind:"public_timeline",caption:"Public Timeline",token:l.token||null,endpoint:l.gheUrl||null};return p(l),a.go("setting/timeline",{newTimeline:e}),!1}});t.cancelButton_click=function(){a.go("setting/timeline")},e.load=function(e){var t=r.load().github||{};s.data={githubToken:t.token||null,gheUrl:t.gheUrl||null},e()};var p=function(e){e&&r.save("github",e)}}},function(e,t){function n(e,t){var n={token:e};t&&(n.rootURL=t+"/api/v3"),this.octo=new Octokat(n),this.loginUser=null}n.prototype.activate=function(e){var t=this;return t.octo.me.fetch().then(function(e){return t.loginUser=e,t.octo.user.orgs.fetch()}).then(function(e){return{user:t.loginUser,orgs:e}})},n.prototype.fetchTarget=function(e,t,n){var i,o=this;return i=t?this.octo.repos(e,t):this.octo.orgs(e),i.fetch().then(function(e){return{user:o.loginUser,target:e}})},e.exports=n},function(e,t){var n={load:function(){var e=null;try{var t=localStorage.getItem("defaults");t&&(e=JSON.parse(t))}catch(n){}return e||{}},save:function(e,t){var n=this.load();void 0!==t?n[e]=t:e in n&&delete n[e],localStorage.setItem("defaults",JSON.stringify(n))}};e.exports=n},function(e,t,n){var i=n(1),o=n(6),r=n(15),a=i.App;e.exports=function(e,t){var n={},l=null,s=new i.ListView("projectSelect","projectItem"),c=e.views.accountForm=new i.FormView("accountForm",{fields:"backlogToken backlogUrl"},function(e,t){t.submit=function(){var t=e.findEl('input[name="backlogUrl"]');t.value=t.value.replace(/\/$/,"");var i=e.data;n={token:i.backlogToken,url:i.backlogUrl};var r=new o(n.token,n.url);return r.loadProjects().then(function(e){l=[{caption:"My Timeline",value:"space"}],e.forEach(function(e){l.push({caption:e.name,value:e.projectKey})}),s.data=l,$("fieldset",u.el).removeAttr("disabled")},function(e){s.data=[],$("fieldset",u.el).attr("disabled","disabled"),n=null,alert("Failed to authenticate Backlog account by token")}),!1}}),u=e.views.projectForm=new i.FormView("projectForm",{fields:"value"},function(e,t){t.submit=function(){var t=e.data,i={token:n.token||null,endpoint:n.url||null,service:"backlog",width:"normal",notify:"off"};return"my_timeline"!==t.value?(l.some(function(e){return i.caption=e.caption,e.value===t.value}),i.kind="project",i.project=t.value):(i.kind="my_timeline",i.caption="My Timeline"),d(n),a.go("setting/timeline",{newTimeline:i}),!1}});t.cancelButton_click=function(){a.go("setting/timeline")},e.load=function(e){var t=r.load().backlog||{};c.data={backlogToken:t.token||null,backlogUrl:t.url||null},e()};var d=function(e){e&&r.save("backlog",e)}}}]);