!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var s=class{constructor(){this._LF_obsrvs=new Map}listen(e,t){if(t)this._listen(e,t);else for(let t in e){const n=e[t];this._listen(t,n)}}unlisten(e,t){const n=this._LF_obsrvs.get(e);if(void 0===n)return;const s=n.indexOf(t);-1!==s&&n.splice(s,1)}say(e,t){this._say(e,e,t),this._say("*",e,t)}_listen(e,t){const n=this._LF_obsrvs.get(e);n?n.push(t):this._LF_obsrvs.set(e,[t])}_say(e,t,n){const s=this._LF_obsrvs.get(e);void 0!==s&&s.forEach(e=>{if(this._isFunc(e))e.call(this,n);else{var s=e[t];this._isFunc(s)&&s.call(e,n)}})}_callR(e,t,n,s){let i=s?this[s]:this;i&&(i=i[n]),i&&i.apply(this,e);const a=this[t];if(a)for(let i in a){const o=a[i];o._callR&&o._callR(e,t,n,s)}}_default(e,t,n){let s=e||{};return t in s||(s[t]=n),s}_isStr(e){return"string"==typeof e}_isFunc(e){return"function"==typeof e}};class i{constructor(e,t){if(this.req=e,"string"==typeof t)this.res=null,this.isTimeout="timeout"===t,this.isAborted="abort"===t,this.isNetworkError="error"===t;else{this.res=t;var n=this.res.status;this.isBadRequest=400===n,this.isForbidden=403===n,this.isUnauthorized=401===n,this.isNotFound=404===n,this.isConflict=409===n,this.isServerError=n>=500}}}var a=class{constructor(e){const t=e||{};this.headers=t.headers||{},this.afterError=t.afterError||function(){},this.authorize=t.authorize||function(){},this.unauthorized=t.unauthorized||null}async exec(e,t,n,s,a){const o=this.headers||{},r={method:e,path:t,headers:o};try{await this.authorize(o,n,s);const l=await this._httpReq(e,t,a,n,s),c=l.status;if(c<400)return l;const d=new i(r,l);if(401===c&&null!=this.unauthorized)return void this.unauthorized(d);throw d}catch(e){return new i(r,e)}}get(e,t,n){return this.exec("GET",e,t,null,n)}post(e,t,n,s,i){const a=i||{};return"Content-Type"in a||(a["Content-Type"]=n||"application/json;charset=UTF-8"),this.exec("POST",e,t,s,a)}put(e,t,n,s,i){const a=i||{};return"Content-Type"in a||(a["Content-Type"]=n||"application/json;charset=UTF-8"),this.exec("PUT",e,t,s,a)}del(e,t,n){return this.exec("DELETE",e,t,null,n)}_httpReq(e,t,n,s,i){var a,o=n||{};if(i){const e=o["Content-Type"];if(e.match(/\/form-data/)){a=new FormData;for(let e in i)a.append(e,i[e])}else a=e.match(/\/json/)?JSON.stringify(i):this._formatParams(i)}else a=void 0;var r=t;return s&&(r+="?"+this._formatParams(s)),new Promise((t,n)=>{var s=new XMLHttpRequest;for(var i in s.open(e,r,!0),o)s.setRequestHeader(i,o[i]);s.onload=(e=>{let n,i=s.getResponseHeader("Content-Type");n=null===i?null:i.match(/\/json/)?JSON.parse(s.response):i.match(/\/form/)?this._fromFormData(s.response):s.response,t({status:s.status,headers:s.getAllResponseHeaders(),body:n})}),s.onabort=function(e){n("abort")},s.onerror=function(e){n("error")},s.ontimeout=function(e){n("timeout")},s.send(a)})}_formatParams(e){return Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&")}_fromFormData(e){const t={};return e.split("&").forEach(e=>{const n=e.split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}),t}};var o=class extends Object{constructor(e,t={}){super(),this._LF_observer=new s,this._LF_parent=t.parent||null;for(let t in e)this[t]=e[t]}update(e,t){const n=(e,t)=>{const n=this[e];n!==t&&(this[e]=t,this._sayUpdate({field:e,newValue:t,oldValue:n}))};if("object"==typeof e)for(let t in e)n(t,e[t]);else n(e,t)}destroy(){this._LF_observer.say("destroy",{}),this._LF_parent&&this._LF_parent.remove(this)}_sayUpdate(e){this._LF_observer.say("update",e),this._LF_parent&&this._LF_parent.update(this)}_addListener(e){this._LF_observer.listen("*",e)}_removeListener(e){this._LF_observer.unlisten("*",e)}};var r=class{constructor(){this._q=Promise.resolve()}push(e){this._q=this._q.then(e)}};var l=class{constructor(e,t){this._view=e,this._model=t,t._addListener(this),this._jobQ=new r}destroy(){this._model._removeListener(this)}add({item:e,index:t}){void 0===t?this._jobQ.push(()=>this._view.addItem(e)):this._jobQ.push(()=>this._view.insertItem(e,t))}update({item:e,index:t}){this._jobQ.push(()=>this._view.updateItem(e,t))}remove({item:e,index:t}){this._jobQ.push(()=>this._view.removeItem(e))}};class c extends s{constructor(e,t){super(),this.id=null,this.el=null,this.views={},this._LF_bindEvts=[],this._LF_binders=[],this._LF_embedded=!1,this._setup(e,t||{})}init(e){}load(e,t){}unload(){}_setup(e,t){console.info("View#_setup",e,t);const n=this._setupProps(t);this.init(n),this._data=n,this._setRootNode(e,t.parent||null,n),this._loadAndSetupEvts(),this._setDataToChildren(this._data)}_setupProps(e){let t=void 0;if(e){(t=e.data)&&delete e.data;for(let t in e)this[t]=e[t]}return t}_setRootNode(e,t,n){if(e)if(this._isStr(e)){if(this.el=t?t.findEl(e):document.body.querySelector(e),!this.el)throw new Error("Failed to create View because element not found ID:"+this.id);this.id=this.el.id}else if(e)this.el=e,this.id=e.id;else if(!this.el)throw new Error("Failed to create View because element not specified")}_loadAndSetupEvts(){console.info("View#_loadAndSetupEvts",this);const e={};this.load.call(this,this.views,e),this._setupEvts(this,c._parseEvts(e))}_bindData(e){if(e instanceof o){const t=new l(this,e);this._LF_binders.push(t)}}_unbindData(){this._LF_binders.forEach(e=>e.destroy()),this._LF_binders=[]}get data(){return this._data}set data(e){this._data=e,this._render(e)}findEl(e){return this.el.querySelector(e)}add(e,t){this.views[e]=t,this.el.appendChild(t.el),t._loadAndSetupEvts()}fire(e,t){const n=t?new CustomEvent(e,{detail:t,bubbles:!0}):new Event(e,{bubbles:!0});this.el.dispatchEvent(n)}destroy(){for(let e in this.views){this.views[e].destroy()}this.views={},this.unload(),this._unbindData(),this._teardownEvts()}unescapeHtml(e){return(new DOMParser).parseFromString(e,"text/html").documentElement.textContent}_render(e){const t=e||this._data;this._setDataToChildren(t)}_setDataToChildren(e){if(void 0!==e){console.info("View#_setDataToChildren",this),this._unbindData();for(let t in e){const n=e[t];if(t in this.views){this.views[t]._render(n);continue}const s=this.findEl("#"+t);if(s)if(n instanceof Object)for(let e in n){const t=n[e];"html"===e?s.innerHTML=t:"value"===e?s.value=t:s.textContent=t}else s.textContent=n}this._bindData(e)}}_embedDataInHTML(e,t){return t&&!this._LF_embedded&&(e=e.replace(/\{\{(.*?)\}\}/g,(e,n)=>this._getEmbeddedData(n,t)),this._LF_embedded=!0),e}_getEmbeddedData(e,t){if(!e)return null!=t?t:"";let n=t;return e.split(".").forEach(e=>{null!=n&&(n=n[e])}),null!=n?n:""}_el(e){return document.getElementById(e)}_setupEvts(e,t){for(let n in t){const s=t[n];if("ROOT"===n){this._bindEvts(this,e.el,s);continue}const i=this._findEvtTarget(n,e.el);i?(i instanceof NodeList?Array.from(i):[i]).forEach(t=>this._bindEvts(e,t,s)):console.warn(`Not found event target ${n}`)}}_findEvtTarget(e,t){return this.findEl("#"+e)}_bindEvts(e,t,n){for(let s in n)this._bindEvt(e,t,s,n[s])}_bindEvt(e,t,n,s){const i=function(t){const n=s.call(e,this,t);return void 0!==n&&n};["click","submit","change"].includes(n)?t["on"+n]=i:t.addEventListener(n,i),this._LF_bindEvts.push([t,n,i])}_teardownEvts(){this._LF_bindEvts.forEach(([e,t,n])=>{["click","submit","change"].includes(t)?e["on"+t]=null:e.removeEventListener(t,n)}),this._LF_bindEvts=[]}_firstEl(e){const t=e.firstElementChild;if(void 0!==t)return t;const n=e.childNodes;for(let e=0,t=n.length;e<t;e++){const t=n[e];if(t.nodeType===Node.ELEMENT_NODE)return t}return null}static _getLFID(){return d()}static _parseEvts(e){const t={ROOT:{}};for(let n in e){const s=n.lastIndexOf("_");if(-1===s){t.ROOT[n]=e[n];continue}const i=n.substr(0,s);let a;(a=i in t?t[i]:t[i]={})[n.substr(s+1)]=e[n]}return t}}const d=(h=0,function(){return"_LF_"+h++});var h,u=c;var m=class extends u{constructor(e,t){super(e,t),this.states={}}get parent(){return this._parent}get context(){return this._ctx||{}}destroy(){super.destroy(),this._parent=null}_setRootNode(e,t,n){if(e)this._isStr(e)&&e.startsWith("#")&&(e=this._findEl(e));else{const t=document.createElement("template");t.innerHTML=this.html(n||{});const s=document.adoptNode(t.content);e=this._firstEl(s)}super._setRootNode(e,t,n),this._isStr(this.childFrame)&&(this.childFrame=this.findEl(this.childFrame))}setState(e){this.states[e].call(this,this.data)}_loadAndSetupEvts(){if(console.info("AreaView#_loadAndSetupEvts",this),this._LF_shown&&this._LF_shown(),this.parent){const e=this.parent.childFrame;if(!e)throw"Area's childFrame isn't defined";for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(this.el)}super._loadAndSetupEvts()}broadcast(e,t){this._callR([e,t],"views","say")}};const p="#!";var v=class{constructor(e,t){t=t||{},this._routeTree=this._parseRoute(e),this._lastRoute=null,this.onMove=t.onMove||function(){},this.mode=t.mode||"HASH";let n=t.rootPath;if(!n){let e=document.querySelector("base");if(e){const t=new URL(e.href).pathname;n=this._chopEndSlash(t)}}this.basePath=n||""}depart(){let e,t,n=this;"HISTORY"===n.mode?(window.document.addEventListener("click",function(e){n._captureClick(e)},!0),t=function(e){try{n.move(e)}catch(e){"string"==typeof e?window.location.href=n.basePath+e:console.error(e)}},window.onpopstate=function(e){t(e.state?e.state.path:"/")},(e=window.location.pathname.substr(this.basePath.length)).length>1&&e.endsWith("/")&&(e=e.substr(0,e.length-1),window.history.replaceState(null,null,e))):"HASH"===n.mode&&(t=function(e){try{n.move(e)}catch(e){"string"==typeof e?window.location.hash=p+e:console.error(e)}},window.onhashchange=function(e){const n=window.location.hash;t(n.substr(p.length)||"/")},e=window.location.hash.substr(p.length)),t(e)}canGo(e){return null!==this.getRoute(e)}go(e){if("HISTORY"===this.mode){const t=window.history;t&&t.pushState&&(t.pushState({path:e},null,this.basePath+e),this.move(e))}else"HASH"===this.mode&&(window.location.hash=p+e)}move(e){const t=this.getRoute(e);this.onMove(t)}getRoute(e){e.startsWith("/")||(e="/"+e);let t=e;"/"===t&&(t+="index"),(t=this._chopEndSlash(t)).endsWith(".html")&&(t=t.substr(0,t.length-5));const n=this._parsePath(t);let s,i=this._routeTree,a={},o=null;for(;void 0!==(s=n.shift());){let r;if(s in i)r=i[s];else{if(!("_any_"in i))throw alert(`${t} page isn't defined`),"/";if(a[i._any_.id]=s,i=i._any_.children,n.length>0)continue;r=i.index}if("string"==typeof r){const t=this._resolve(e,r);return window.history.replaceState(null,null,t),this.getRoute(t)}r.prototype instanceof m?o={view:r,ctx:a}:(i=r,0===n.length&&n.unshift("index"))}if(o)return o;throw alert(`${t} page not found`),"/"}_captureClick(e){const t=document.activeElement;if(t&&"A"===t.tagName&&"_top"!==t.target&&t.href.startsWith(window.location.origin+this.basePath)){e.preventDefault();try{this.go(t.pathname.substr(this.basePath.length))}catch(e){"string"==typeof e?this.go(e):console.error(e)}}}_parsePath(e){const t=e.split("/");return t.shift(),t}_parseRoute(e){const t={};for(let n in e){const s=e[n],i=s.prototype instanceof u||"string"==typeof s;if(n.startsWith(":")){const e=t._any_={id:n.substr(1)};e.children=i?{index:s}:this._parseRoute(s)}else t[n]=i?s:this._parseRoute(s)}return t}_resolve(e,t){if(t.startsWith("/"))return t;const n=e.split("/");let s;for(;s=t.match(/^\.\.\/?(.*)$/);)n.pop(),t=s[1];return n.join("/")+t}_chopEndSlash(e){return e.endsWith("/")?e.substr(0,e.length-1):e}};var f=class{constructor(e){this._rootArea=e,this._contentArea=null}get contentArea(){return this._contentArea}replaceLayer(e){this._removeLayer(),this._addLayer(e),this._updateTitle()}broadcast(e,t){this._layers.forEach(function(n){n.area.broadcast(e,t)})}_removeLayer(){const e=this._contentArea;e&&(e.destroy(),this._contentArea=null)}_addLayer(e){const t=Object.assign({},this._rootArea.context);this._contentArea=new e.view(null,{_parent:this._rootArea,_ctx:Object.assign(t,e.ctx)})}_updateTitle(){let e="";if(this._contentArea){const t=this._contentArea;e=t.title?t.title():""}document.title=this._rootArea.title(e)}};var g=new class{constructor(){}activate(e,t,n){const s={onMove:e=>{this._onMove(e)},mode:(n=n||{}).mode,rootPath:n.rootPath};this._router=new v(t,s),this._screen=new f(new e),window.onload=(e=>{this._onLoad(e)})}go(e,t){return this._preCtx=t,this._router.go(e),!1}back(){return window.history.back(),!1}_onLoad(){this._hashChanged=!1,this._router.depart()}_onMove(e){this._preCtx&&(e.ctx=Object.assign(e.ctx||{},this._preCtx),this._preCtx=null),this._screen.replaceLayer(e)}};var b=class extends u{constructor(e){super(null,e||{})}_findEvtTarget(e,t){let n=t.querySelector("."+e);return n||"FORM"!==t.tagName||(n=t[e]||null),n}_setupProps(e){return super._setupProps(Object.assign(e||{},this._LF_props))}_setRootNode(e,t,n){const s=document.createElement("template");s.innerHTML=this.html(n);const i=document.adoptNode(s.content);e=this._firstEl(i),t&&t.el.appendChild(e),super._setRootNode(e,t,n)}static disableCache(){this._LF_noCache=!0}};var w=class extends o{constructor(e,t={}){super(),t.wrapItem?!0===t.wrapItem?this._LF_itemClass=o:this._LF_itemClass=t.wrapItem:this._LF_itemClass=null,this._data=e?e.map(e=>this._LF_itemClass?this._wrapItem(e):e):[]}set itemClass(e){this._LF_itemClass=e}get(e){return this._data[e]}add(e,t){this._LF_itemClass&&(e=this._wrapItem(e)),void 0===t?this._data.push(e):this._data.splice(t,0,e),this._LF_observer.say("add",{item:e,index:t})}update(e,t){void 0===t&&(t=this._data.indexOf(e)),this._data[t]=e,this._LF_observer.say("update",{item:e,index:t})}remove(e){"number"!=typeof e&&(e=this._data.indexOf(e));const t=this._data.splice(e,1)[0];t instanceof o&&(t._LF_parent=null),this._LF_observer.say("remove",{item:t,index:e})}addAll(e,t){e.forEach(e=>this.add(e,t))}removeAll(e){if((e=e||{}).reverse)for(let e=this.length-1;e>=0;e--)this.remove(e);else for(;this._data.length;)this.remove(0)}removeLast(){this.remove(this.length-1)}reset(e=[]){this.removeAll(),this.addAll(e)}find(e,t){const n=this.indexOf(e,t);return n>=0?this._data[n]:void 0}indexOf(e,t){if(void 0===t)return this._data.indexOf(e);const n="function"==typeof e?e:function(n){return n[e]===t};for(let e=0,t=this._data.length;e<t;e++)if(n(this._data[e]))return e;return-1}forEach(e){this._data.forEach(e)}some(e){return this._data.some(e)}get length(){return this._data.length}[Symbol.iterator](){return this._data[Symbol.iterator]()}_addListener(e){this._LF_observer.listen("*",e)}_removeListener(e){this._LF_observer.unlisten("*",e)}_wrapItem(e){return e instanceof o?e:new this._LF_itemClass(e,{parent:this})}};var y=class extends u{constructor(e,t,n){super(e,Object.assign(n||{},{_LF_tmpl:t})),this._LF_itemSet={}}getItemAt(e){const t=this._childElementAt(e).getAttribute("_lfid_");return this._LF_itemSet[t]}async addItem(e){const t=await this._createViewByItem(e);return this.addItemEl(this.el,t.el),t}async insertItem(e,t){const n=await this._createViewByItem(e);return this.insertItemEl(this.el,n.el,this._childElementAt(t)),n}updateItem(e,t){const n=this._childElementAt(t).getAttribute("_lfid_");this._LF_itemSet[n]=e,this.views[n].data=e}removeItem(e){const t=this.views;for(let n in t)if(t[n]===e||t[n]._data===e)return void this.removeItemByEl(t[n].el)}removeItemAt(e){const t=e>=0?this._childElementAt(e):this.el.lastElementChild;this.removeItemByEl(t)}removeItemByEl(e){const t=e.getAttribute("_lfid_");delete this._LF_itemSet[t];const n=this.views;n[t].unload(),delete n[t],this.removeItemEl(this.el,e)}removeItemByView(e){this.removeItemByEl(e.el)}onItemLoad(e,t){}addItemEl(e,t){e.appendChild(t)}insertItemEl(e,t,n){e.insertBefore(t,n)}removeItemEl(e,t){e.removeChild(t)}itemClass(e){return this._LF_tmpl}_bindData(e){if(e instanceof w){const t=new l(this,e);this._LF_binders.push(t)}}_childElementAt(e){const t=this.el.children;let n=0;for(let s=0,i=t.length;s<i;s++){const i=t[s];if("TEMPLATE"!==i.tagName){if(e===n)return i;n++}}return null}async _createViewByItem(e){const t=u._getLFID(),n=this.itemClass(e),s=e instanceof u?e:new n({data:e});return this._LF_itemSet[t]=s,this.views[t]=s,s.el.setAttribute("_lfid_",t),s}async _setDataToChildren(e){if(void 0!==e){console.info("ListView#_setDataToChildren",this),this._LF_itemSet={};for(let t of e)await this.addItem(t);this._bindData(e),this._data=e}}};var _=class extends u{constructor(e,t){super(e,t||{})}get data(){return this._dataFromFields()}set data(e){this._data=e,this._render(e)}get fields(){if(!this._fields){const e=[],t=this.el;for(let n=0;n<t.length;n++){const s=t[n].name;s&&e.push(s)}this._fields=e}return this._fields}set fields(e){let t=e;this._isStr(t)&&(t=t.split(/\s+/)),this._fields=t||[]}_setDataToChildren(e){this._dataToFields(e)}_dataFromFields(){const e={};return this.fields.forEach(t=>{const n=this.el[t]||this.el.dataset[t]||this._el(t);if(n)return void(e[t]=n.value);const s=this.views[t];s&&(e[t]=s.value)}),e}_dataToFields(e){e&&this.fields.forEach(t=>{const n=e[t]||null;let s=this.el[t]||this.el.dataset[t]||null;if(s&&"value"in s)return void(s.value=n);"textContent"in(s=this.findEl(t))&&(s.textContent=n||"");const i=this.views[t];i&&("value"in i?i.value=n:"value"in i.el&&(i.el.value=n))})}_findEvtTarget(e,t){return t[e]||this.findEl("#"+e)}};var E=class{constructor(e,t){const n={token:e};t&&(n.rootURL=t+"/api/v3"),this.octo=new Octokat(n),this.loginUser=null,this.token=e,this.endpoint=t||null}activate(){return this.octo.me.fetch().then(e=>(this.loginUser=e,this.octo.user.orgs.fetch())).then(e=>({user:self.loginUser,orgs:e}))}fetchTarget(e,t){let n;return(n=t?this.octo.repos(e,t):this.octo.orgs(e)).fetch().then(e=>({user:this.loginUser,target:e}))}};var T={load:function(){let e={};try{const t=localStorage.getItem("defaults");t&&(e=JSON.parse(t))}catch(e){}return e},save:function(e,t){const n=this.load();void 0!==t?n[e]=t:e in n&&delete n[e],localStorage.setItem("defaults",JSON.stringify(n))}};let A;class I extends _{load(e,t){t.submit=((e,t)=>{const n={service:"github",width:"normal",notify:"off",kind:"my_pullreq_states",caption:"PullRequest states",token:A.token,endpoint:A.endpoint};return this.fire("timelineAdded",n),!1})}}class R extends b{html(e){return`<option value="${e.value}">${e.caption}</option>`}}class k extends _{load(e,t){this.timelines=new w,e.selectList=new y("#githubTimelineSelect",R,{data:this.timelines}),t.submit=((e,t)=>{const n=this.findEl('input[name="gheUrl"]');n.value=n.value.replace(/\/$/,"");const s={token:this.data.githubToken,gheUrl:this.data.gheUrl};return(A=new E(s.token,s.gheUrl)).activate().then(e=>{const t=[{caption:"My Timeline",value:"my_timeline"}];e.orgs.items.forEach(e=>{t.push({caption:e.login,value:e.login})}),this.timelines.reset(t),this.fire("fieldStateChanged",{enabled:!0})}).catch(e=>{this.timelines.reset([]),this.fire("fieldStateChanged",{enabled:!1}),alert("Failed to authenticate GitHub account by token")}),!1})}}class U extends _{load(e,t){t.submit=((e,t)=>{var n=this.data.value.split("/"),s=n[0],i=n.length>1?n[1]:null;return A.fetchTarget(s,i).then(e=>{this.register(this.data)}).catch(e=>{alert("Failed to access repository")}),!1})}register(e){e.token=A.token,e.endpoint=A.endpoint,e.service="github",e.width="normal",e.caption=e.value;const t=e.value.split("/");1===t.length?(e.org=t[0],e.kind="org"):(e.owner=t[0],e.repo=t[1],e.kind="repo"),this.fire("timelineAdded",e)}}class S extends _{load(e,t){t.submit=((e,t)=>{const n=this.data;return n.token=A.token,n.endpoint=A.endpoint,n.service="github",n.width="normal",n.notify="off","my_timeline"!==n.value?(n.kind="private",n.caption=n.value):(n.kind="my_timeline",n.caption="My Timeline"),this.fire("timelineAdded",n),!1})}}class L extends _{load(e,t){t.submit=((e,t)=>{const n={service:"github",width:"normal",notify:"off",kind:"public_timeline",caption:"Public Timeline",token:A.token,endpoint:A.endpoint};return this.fire("timelineAdded",n),!1})}}var O=class extends m{html(e){return'<div class="setting page">\n  <h1>Add GitHub timeline</h1>\n\n  <section>\n    <h2>1. Account</h2>\n\n    <form id="accountForm">\n      <div class="field">\n        <label for="githubToken">Access Token</label>\n        <input name="githubToken" type="text" class="full" placeholder="Access Token">\n        <p class="remarks">\n          <a href="https://github.com/settings/tokens" target="_blank">Create token for Deck</a>\n          （Please check <b>repo</b>, admin:org/<b>read:org</b>, <b>notifications</b> at <b>Select scopes</b>!）\n        </p>\n      </div>\n\n      <div class="field">\n        <label for="gheUrl">Root URL for GitHub Enterprize</label>\n        <input name="gheUrl" type="text" class="large" value="" placeholder="https://github.yourcompany.com">\n        <p class="remarks">Let it empty if you use github.com</p>\n      </div>\n\n      <button class="button primary" type="submit">Activate</button>\n    </form>\n  </section>\n\n  <section>\n    <h2>2. Notifications &amp; Timeline</h2>\n\n    <form id="notificationsForm">\n      <fieldset  class="field" disabled="disabled">\n        <label>Your pullrequest states</label>\n        <button type="submit" class="button primary">Add pullrequest states</button>\n      </fieldset>\n    </form>\n\n    <form id="yourTimelineForm">\n      <fieldset class="field" disabled="disabled">\n        <label>Your timelines</label>\n        <select id="githubTimelineSelect" name="value"></select>\n        <button type="submit" class="button primary">Add timeline</button>\n      </fieldset >\n    </form>\n\n    <form id="repositoryForm">\n      <fieldset  class="field" disabled="disabled">\n        <label>Repository</label>\n        <input type="text" name="value" class="large" value="" placeholder="owner/repository">\n        <button type="submit" class="button primary">Add timeline</button>\n      </fieldset>\n    </form>\n\n    <form id="publicTimelineForm">\n      <fieldset  class="field" disabled="disabled">\n        <label>Public Timeline</label>\n        <button type="submit" class="button primary">Add timeline</button>\n      </fieldset>\n    </form>\n  </section>\n\n  <hr>\n\n  <div class="form-actions">\n    <button class="button" id="cancelButton">Cancel</button>\n  </div>\n</div>'}load(e,t){const n=e.notificationsForm=new I("#notificationsForm",{fields:"githubToken gheUrl"}),s=e.accountForm=new k("#accountForm",{fields:"githubToken gheUrl"}),i=e.repositoryForm=new U("#repositoryForm",{fields:"value"}),a=e.timelineForm=new S("#yourTimelineForm",{fields:"value"}),o=e.PublicTimelineForm=new L("#publicTimelineForm",{fields:"value"});t.cancelButton_click=function(){g.go("settings/timeline")},t.timelineAdded=((e,t)=>{const n=t.detail;T.save("github",{token:n.token,gheUrl:n.endpoint}),g.go("settings/timeline",{newTimeline:n})}),t.fieldStateChanged=((e,t)=>{const s=!t.detail.enabled;n.el.querySelectorAll("fieldset").forEach(e=>{e.disabled=s}),i.el.querySelectorAll("fieldset").forEach(e=>{e.disabled=s}),a.el.querySelectorAll("fieldset").forEach(e=>{e.disabled=s}),o.el.querySelectorAll("fieldset").forEach(e=>{e.disabled=s})});const r=T.load().github||{};s.data={githubToken:r.token||null,gheUrl:r.gheUrl||null}}};var N=class{constructor(e,t){this.token=e,this.url=t}loadProjects(e){return(new a).get(`${this.url}/api/v2/projects`,{apiKey:this.token}).then(e=>e.body.filter(e=>!e.archived))}fetch(e,t){let n={apiKey:this.token};return e.latestId&&(n.minId=e.latestId+1),e.count&&(n.count=e.count),(new a).get(`${this.url}${e.path}`,n).then(e=>e.body.filter(e=>!e.archived))}};let C;class x extends _{constructor(e){super("#accountForm",e)}load(e,t){t.submit=(()=>{const e=this.findEl('input[name="backlogUrl"]');e.value=e.value.replace(/\/$/,"");const t=this.data;return(C=new N(t.backlogToken,t.backlogUrl)).loadProjects().then(e=>{const t=[{caption:"My Timeline",value:"space"}];e.forEach(e=>{t.push({caption:e.name,value:e.projectKey})}),this.fire("fieldStateChanged",{enabled:!0,projectList:t})}).catch(e=>{this.fire("fieldStateChanged",{enabled:!1,projectList:[]}),alert("Failed to authenticate Backlog account by token")}),!1})}}class F extends b{html(e){return`<option value="${e.value}">${e.caption}</option>`}}class H extends _{load(e,t){this.projectList=new w,e.selectList=new y("#projectSelect",F,{data:this.projectList}),t.submit=(()=>{const e=this.data,t={service:"backlog",width:"normal",notify:"off",token:C.token||null,endpoint:C.url||null};return"my_timeline"!==e.value?(this.projectList.some(n=>(t.caption=n.caption,n.value===e.value)),t.kind="project",t.project=e.value):(t.kind="my_timeline",t.caption="My Timeline"),this.fire("timelineAdded",t),!1})}}var P=class extends m{html(e){return'<div class="setting page">\n  <h1>Add Backlog timeline</h1>\n\n  <section>\n    <h2>1. Account</h2>\n\n    <form id="accountForm">\n      <dl class="form">\n       <dt><label for="backlogUrl">API Root URL</label></dt>\n       <dd>\n        <input name="backlogUrl" type="text" class="large" value="" placeholder="https://<your>.backlog.jp">\n        <p class="remarks">ブラウザで見るURLと同等</p>\n       </dd>\n      </dl>\n\n      <dl class="form">\n       <dt><label for="backlogToken">API Token</label></dt>\n       <dd>\n        <input name="backlogToken" type="text" class="full" placeholder="">\n        <p class="remarks">個人設定 -> API 画面で発行したトークン</p>\n       </dd>\n      </dl>\n\n      <button type="submit" class="button primary">Load projects</button>\n    </form>\n  </section>\n\n  <section>\n    <h2>2. Project</h2>\n    <form id="projectForm">\n      <fieldset class="field" disabled="disabled">\n        <select id="projectSelect" name="value"></select>\n        <button type="submit" class="button primary">Add timeline</button>\n      </fieldset>\n    </form>\n  </section>\n\n  <hr>\n\n  <div class="form-actions">\n    <button class="button" id="cancelButton">Cancel</button>\n  </div>\n</div>'}load(e,t){const n=e.accountForm=new x({fields:"backlogToken backlogUrl"}),s=e.projectForm=new H("#projectForm",{fields:"value"});t.cancelButton_click=function(){g.go("settings/timeline")},t.timelineAdded=((e,t)=>{const n=t.detail;T.save("backlog",{token:n.token,url:n.endpoint}),g.go("settings/timeline",{newTimeline:n})}),t.fieldStateChanged=((e,t)=>{const n=!t.detail.enabled;s.el.querySelectorAll("fieldset").forEach(e=>{e.disabled=n}),s.projectList.reset(t.detail.projectList)});const i=T.load().backlog||{};n.data={backlogToken:i.token||null,backlogUrl:i.url||null}}};class j extends b{html(e){return`     <div class="column">\n      <span class="remove mega-octicon octicon-x"></span>\n      <div class="service">${e.service}</div>\n      <div class="project"></div>\n\n      <div class="field">\n        <label for="widthSelect">width</label>\n        <select class="select-sm widthSelect" name="widthSelect">\n          <option value="normal">normal</option>\n          <option value="narrow">narrow</option>\n          <option value="wide">wide</option>\n        </select>\n      </div>\n\n      <div class="field">\n        <label for="notifySelect">notify</label>\n        <select class="select-sm notifySelect" name="notifySelect">\n          <option value="off">Off</option>\n          <option value="mentioned">Mentioned</option>\n          <option value="all">On</option>\n        </select>\n      </div>\n\n      <div class="control clearfix">\n        <span class="left moveLeft mega-octicon octicon-arrow-left"></span>\n        <span class="right moveRight mega-octicon octicon-arrow-right"></span>\n      </div>\n     </div>`}load(e,t){t.remove_click=(()=>{this.el.classList.add("fadeOut"),setTimeout(()=>{this.fire("delete",{item:this.data})},400)}),t.moveLeft_click=(()=>{this.fire("move",{pos:-1,item:this.data})}),t.moveRight_click=(()=>{this.fire("move",{pos:1,item:this.data})}),t.widthSelect_change=((e,t)=>{this.data.width=e.value}),t.notifySelect_change=((e,t)=>{this.data.notify=e.value}),this.findEl(".widthSelect").value=this.data.width,this.findEl(".notifySelect").value=this.data.notify||"off",this.findEl(".project").innerHTML=this.data.caption.split("/").join("/<wbr>")}}class q extends y{load(e,t){t.move=((e,t)=>{const{item:n,pos:s}=t.detail,i=this.data.indexOf(n),a=i+s;-1!==a&&a!==this.data.length&&(this.data.remove(i),this.data.add(n,a))}),t.delete=((e,t)=>{this.data.remove(t.detail.item)})}}var V=new class extends s{constructor(){super(),this.listen("notify",e=>{if(!this.hasNewArrival&&e.notify){this.hasNewArrival=!0,document.querySelector("#favicon").href="img/favicon-new.ico";const e=t=>{this.say("clear"),document.body.removeEventListener("click",e,!1)};document.body.addEventListener("click",e)}if("notify"in e&&"off"!==e.notify&&"Notification"in window&&"granted"===Notification.permission){let t;if(e.mentions)t=`Your are mentioned ${e.message}`;else{if("mentioned"===e.notify)return;t=e.message}const n=new Notification(e.title,{body:t,icon:"img/apple-touch-icon-180x180.png"});n.onclick=function(){window.focus()},setTimeout(()=>n.close(),6e3)}}),this.listen("clear",e=>{document.querySelector("#favicon").href="img/favicon-default.ico",this.hasNewArrival=!1})}};class M extends b{load(e,t){this.items=new w,this.loadStream(this.data),e.eventList=new y(this.findEl(".timelineBody"),this.itemViewClass,{data:this.items}),t.timelineHeader_click=((e,t)=>{if("SPAN"===t.target.tagName)return!0;this.fire("clickedTimelineHeader",this.data)}),t.clickedTimelineHeader=((e,t)=>{const n=this.findEl(".timelineBody"),s=-n.scrollTop/10,i=setInterval(()=>{0!=n.scrollTop?n.scrollBy(0,s):clearInterval(i)},30)})}unload(){this.model.stopAutoLoad()}destroyed(){return!this.el.parentNode}loadStream(e){throw new Error("Not Implement")}refreshed({items:e,notify:t}){this.items.reset(e),t&&newArrival.say("notify",Object.assign({notify:this.model.notify},t))}loadMore({newItems:e,notify:t}){this.destroyed()||(t&&newArrival.say("notify",t),e.reverse().forEach(e=>{e.newArrival=!0,this.items.add(e,0)}),this.findEl("header").classList.add("newArrival"))}}var B=class extends s{constructor(e,t){super(),this.client=new N(e,t),this.rootUrl=t,this.latestId=0}activate(e){this.tlinfo=e,this.interval=6e4;let t=e.project;return this.fetchPath="/api/v2/"+("space"==t?"space":"projects/"+t)+"/activities",this.webUrl=this.rootUrl+("space"==t?"/dashboard":"/projects/"+t),this.client.fetch({path:this.fetchPath,count:40}).then(t=>{this.latestId=t.length>0?parseInt(t[0].id,10):0;const n={name:e.caption,url:this.webUrl,eventList:t,notify:e.notify||"off"};return setTimeout(()=>{this.loadNew()},this.interval),{model:this,data:n,name:n.name,notify:n.notify||"off"}})}loadNew(){if(0===this.interval)return!1;this.client.fetch({path:this.fetchPath,minId:this.latestId+1}).then(e=>{let t,n=0;for(let s=0,i=e.length;s<i&&!((t=parseInt(e[s].id,10))<=this.latestId);s++)n++;if(this.interval>0&&setTimeout(()=>this.loadNew(),this.interval),0===n)return;this.latestId=e.length>0?parseInt(e[0].id,10):0;const s=e.slice(0,n),i={notify:this.tlinfo.notify||"off",title:"Backlog "+this.tlinfo.caption,message:n+" new event(s)"};this.say("newArrived",{newItems:s,notify:i})})}stopAutoLoad(){this.interval=0}},D=function(e){let t=(new Date).getTime(),n=new Date(e),s=n.getHours(),i=n.getMinutes();return s<10&&(s=" "+s),i<10&&(i="0"+i),t-n.getTime()<432e5?s+":"+i:n.getMonth()+1+"."+n.getDate()+" "+s+":"+i};function G(e){this.rootUrl=e,this.views=function(){class e extends b{html(e){return`      <p class="issueChange">\n        <span class="changeField">${e.field}</span>\n        <span class="changeOld">${e.oldValue}</span>\n        <span class="changeMark">${e.mark}</span>\n        <span class="changeNew">${e.newValue}</span>\n      </p>`}}class t extends b{html(e){return`      <p class="issueAttachment">\n        <span class="changeNew">${e.name}</span><br>\n        <img src="${e.imageUrl}" alt="${e.name}">\n      </p>`}}class n extends b{html(e){return`      <p class="pushCommit">\n        <a href="${e.commitUrl}"><code>${e.sha}</code></a>\n        <span>${e.message}</span>\n      </p>`}load(e,t){e.commits=new y(this.findEl(".pushCommits"),"pushCommit")}}return{EventView:class extends b{html(e){return`      <div class="backlogEvent">\n        <header>\n          <a class="eventRepo" href="${e.projectUrl}">${e.project.name}</a>\n          <span class="eventTime"><time>${e.createdAt}</time></span>\n        </header>\n\n        <div class="eventInfo">\n          <span class="actor">${e.actor.name}</span> &nbsp;\n          <span class="action updateIssue">${e.action}</span>\n        </div>\n        <div class="issue">\n          <a href="${e.url}">${e.projectKeyId}</a>\n          <span>${e.summary}</span>\n        </div>\n\n        <div class="issueChanges"></div>\n\n        <div class="commentBody quote"></div>\n\n        <div class="issueAttachments"></div>\n      </div>`}load(n,s){n.changes=new y(this.findEl(".issueChanges"),e),n.attachments=new y(this.findEl(".issueAttachments"),t);const i=this.findEl(".commentBody"),a=this.data.diff;i.innerHTML=marked(a?a.newValue:this.data.desc||"")}},WikiView:class extends b{html(e){return`      <div class="backlogWikiEvent backlogEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.projectUrl}">${e.project.name}</a>\n          <span class="eventTime"><time>${e.createdAt}</time></span>\n        </header>\n\n        <div class="eventInfo">\n          <span class="actor">${e.actor.name}</span> &nbsp;\n          <span class="action wiki">${e.action}</span>\n        </div>\n\n        <div class="issue">\n          <span>${e.file}</span>\n        </div>\n\n        <div class="commentBody quote"></div>\n      </div>`}load(e,t){this.findEl(".commentBody").innerHTML=marked(this.data.diff||"")}},GitPushView:class extends b{html(e){return`      <div class="BacklogGitPushEvent backlogEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.projectUrl}">${e.project.name}</a>\n          <span class="eventTime"><time>${e.createdAt}</time></span>\n        </header>\n\n        <div class="eventInfo">\n          <span class="actor">${e.actor.name}</span> &nbsp;\n          <span class="action gitPushed">${e.action}</span>\n        </div>\n\n        <div class="issue">\n          <a href="${e.repoUrl}">${e.repoName}</a>　の\n          <a class="branch-ref" href="${e.branchUrl}">${e.branch}</a>\n        </div>\n\n        <div class="pushCommits"></div>\n      </div>`}load(e,t){e.commits=new y(this.findEl(".pushCommits"),n)}},FileView:class extends b{html(e){return`      <div class="backlogFileEvent backlogEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.projectUrl}">${e.project.name}</a>\n          <span class="eventTime"><time>${e.createdAt}</time></span>\n        </header>\n\n        <div class="eventInfo">\n          <span class="actor">${e.actor.name}</span> &nbsp;\n          <span class="action updateIssue">${e.action}</span>\n        </div>\n\n        <div class="issue">\n          <span>${e.file}</span>\n        </div>\n      </div>`}},JoinView:class extends b{html(e){return`      <div class="backlogJoinEvent backlogEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.projectUrl}">${e.project.name}</a>\n          <span class="eventTime"><time>${e.createdAt}</time></span>\n        </header>\n\n        <div class="eventInfo">\n          <span class="actor">${e.actor.name}</span> &nbsp;\n          <span class="action projectUser">${e.action}</span>\n        </div>\n\n        <div class="joinProject">\n         <p>${e.users} がメンバー${e.move}</p>\n        </div>\n      </div>`}}}}()}G.prototype={Wiki:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:D(e.created),actor:e.createdUser,project:e.project,file:e.content.name,diff:e.content.diff||e.content.content};return new this.views.WikiView({data:t})},File:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:D(e.created),actor:e.createdUser,project:e.project,file:e.content.dir+e.content.name};return new this.views.FileView({data:t})},Join:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:D(e.created),actor:e.createdUser,project:e.project,move:15==e.type?"に加わりました。":"から外れました。",users:e.content.users.map(function(e){return e.name}).join(", ")};return new this.views.JoinView({data:t})},GitPush:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:D(e.created),actor:e.createdUser,project:e.project,projectKey:e.project.projectKey,repoName:e.content.repository.name},n=this.rootUrl+"/git/"+t.projectKey+"/"+t.repoName;return t.repoUrl=n,t.branch=e.content.ref.replace(/^refs\/heads\//,""),t.branchUrl=n+"/tree/"+t.branch,t.commits=function(e,t){return t.map(function(t){return{sha:t.rev.substr(0,6),commitUrl:e+"/commit/"+t.rev,message:t.comment}})}(n,e.content.revisions),new this.views.GitPushView({data:t})},Event:function(e){var t={projectUrl:this.rootUrl+"/projects/"+e.project.projectKey,action:this.typeCaption[e.type],createdAt:D(e.created),actor:e.createdUser,project:e.project,projectKeyId:e.project.projectKey+"-"+e.content.key_id,summary:e.content.summary,desc:e.content.description};return this.analyzeChanges(t,e.content.changes),e.content.attachments&&(t.attachments=this.convertAttachments(this.rootUrl,e.content.attachments)),t.url=this.rootUrl+"/view/"+t.projectKeyId,e.content.comment&&(t.desc=e.content.comment.content),new this.views.EventView({data:t})},typeCaption:[null,"課題の追加","課題の更新","課題にコメント","課題の削除","Wikiを追加","Wikiを更新","Wikiを削除","共有ファイルを追加","共有ファイルを更新","共有ファイルを削除","Subversionコミット","GITプッシュ","GITリポジトリ作成","課題をまとめて更新","プロジェクトに参加","プロジェクトから脱退","コメントにお知らせを追加","プルリクエストの追加","プルリクエストの更新","プルリクエストにコメント"],statuses:[null,"未対応","処理中","処理済み","完了"],resolutions:["対応済み","対応しない","無効","重複"],priorities:[null,null,"高","中","低"],convertChange:function(e){var t;return"status"==e.field?t={field:"状態",newValue:this.statuses[parseInt(e.new_value)],mark:"→",oldValue:this.statuses[parseInt(e.old_value)]}:"resolution"==e.field?t={field:"完了理由",newValue:this.resolutions[parseInt(e.new_value)],mark:"→",oldValue:this.resolutions[parseInt(e.old_value)]}:"priority"==e.field?t={field:"優先度",newValue:this.priorities[parseInt(e.new_value)],mark:"→",oldValue:this.priorities[parseInt(e.old_value)]}:"attachment"==e.field?t={field:"添付ファイル",newValue:e.new_value,mark:"",oldValue:e.old_value}:"assigner"==e.field?t={field:"担当",oldValue:e.old_value,mark:"→",newValue:e.new_value}:"description"==e.field?t={field:"diff",oldValue:e.old_value,mark:"→",newValue:e.new_value}:"limitDate"==e.field?t={field:"期限日",oldValue:e.old_value,mark:"→",newValue:e.new_value}:"issueType"==e.field?t={field:"種別",oldValue:e.old_value,mark:"→",newValue:e.new_value}:"parentIssue"==e.field&&(t={field:"親課題",oldValue:e.old_value,mark:"→",newValue:e.new_value}),t?t.oldValue||(t.mark=""):t={},t},analyzeChanges:function(e,t){if(t){var n=this;e.changes=[],t.forEach(function(t){var s=n.convertChange(t);"diff"==s.field?e.diff=s:e.changes.push(s)})}},convertAttachments:function(e,t){var n=[];return t.forEach(function(t){try{var s=t.name,i=s.substr(s.lastIndexOf(".")+1).toLowerCase();"png"!=i&&"jpg"!=i&&"gif"!=i||n.push({imageUrl:e+"/ViewAttachmentImage.action?attachmentId="+t.id,id:t.id,name:s,size:t.size})}catch(e){}}),n},createView:function(e){switch(e.type){case 5:case 6:case 7:return this.Wiki(e);case 12:return this.GitPush(e);case 8:case 9:case 10:case 11:case 13:return this.File(e);case 15:case 16:return this.Join(e);default:return this.Event(e)}}};var W=G;class Y extends b{html(){return'<div class="backlogItem"></div>'}load(e,t){const{viewFactory:n}=this.data,s=n.createView(this.data);s&&(this.add("item",s),this.data.newArrival&&this.el.classList.add("newArrival"))}}var J=class extends M{get itemViewClass(){return Y}html(e){return`    <div class="timeline backlog">\n      <header class="timelineHeader">\n        <a href="${e.url}" target="_blank">\n          <span class="service">Backlog</span>\n          <span class="project">${e.caption}</span>\n        </a>\n      </header>\n      <div class="timelineBody"></div>\n    </div>`}loadStream(e){this.model=new B(e.token,e.endpoint),this.model.activate(e).then(e=>{const t=e.data;this.findEl(".timelineHeader > a").href=t.url;const n=new W(e.model.rootUrl);this.items.itemClass=class extends o{get viewFactory(){return n}},this.items.reset(t.eventList)}).catch(e=>{alert("Can't fetch Backlog information")}),this.model.listen("newArrived",e=>this.loadMore(e))}loadMore(e){this.destroyed()||(e.notify&&V.say("notify",e.notify),e.newItems.reverse().forEach(e=>{e.newArrival=!0,this.items.add(e,0)}),this.findEl("header").classList.add("newArrival"))}};var z=class extends s{constructor(e,t){super();const n={token:e};t&&(n.rootURL=t+"/api/v3"),this.octo=new Octokat(n),this.loginUser=null,this.fetcher=null,this.latestId=0,this.isPublic=!e,this.webUrl=t||"https://github.com",this.v4client=graphql("https://api.github.com/graphql",{headers:{Authorization:`Bearer ${e}`},asJSON:!0})}async activate(e){this.tlinfo=e,this.name=e.caption,this.interval=6e4,this.notify=e.notify||"off";const t=await this.getLoginUser();"my_pullreq_states"===e.kind?(e.value=t.login,this.setupMyNotifications()):this.setupEvents(t)}async getLoginUser(){return this.isPublic?null:(this.loginUser=await this.octo.me.fetch(),this.loginUser)}setupMyNotifications(){this.url="https://github.com/notifications",this.type="notification",this.loadNotifications()}setupEvents(e){const t=this.tlinfo;"my_timeline"==t.kind?(this.fetcher=this.octo.users(e.login).receivedEvents,t.value=e.login,this.url=`https://github.com/${e.login}`):"org"==t.kind?(this.fetcher=this.octo.orgs(t.org).events,this.url=`https://github.com/${t.org}`):"repo"==t.kind?(this.fetcher=this.octo.repos(t.owner,t.repo).events,this.url=`https://github.com/${t.owner}/${t.repo}`):"private"==t.kind?(this.fetcher=this.octo.users(e.login).events.orgs(t.value),this.url=`https://github.com/${t.value}`):"public_timeline"==t.kind&&(this.fetcher=this.octo.events,t.value="Public",this.url="https://github.com/"),this.type="event",this.loadFirstEvents()}async loadNotifications(){const e=new Date((new Date).getTime()-2592e6).toISOString(),{items:t}=await this.octo.notifications.fetch({since:e}),n=[];t.forEach(({subject:e})=>{const{type:t,url:s}=e;if("PullRequest"===t){const[e,t,i,a]=s.match(/\/([^\/]+)\/([^\/]+)\/pulls\/(\d+)$/);n.push(this.fetchPullReqDetail(t,i,Number(a)))}});let s=await Promise.all(n);const i=(s=(s=(s=s.reduce((e,t)=>e.concat(t),[])).filter(e=>"MERGED"!==e.state)).sort((e,t)=>e.updatedAt<t.updatedAt?1:e.updatedAt>t.updatedAt?-1:0)).length?new Date(s[0].updatedAt).getTime():0;let a=null;this.latestId&&this.latestId<i&&(a={title:`GitHub ${this.name}`,message:"New states for PullRequests"}),this.latestId=i,this.say("refresh",{items:s,notify:a}),this.interval&&setTimeout(async()=>{await this.loadNotifications()},this.interval)}async loadFirstEvents(){const{items:e}=await this.fetcher.fetch({per_page:60});this.latestId=e.length>0?parseInt(e[0].id,10):0,this.applyMention(e),this.say("refresh",{items:e,notify:null}),this.interval&&setTimeout(async()=>{await this.loadNewEvents()},this.interval)}async loadNewEvents(){if(!this.interval)return;const{items:e}=await this.fetcher.fetch();let t,n=0;for(let s=0,i=e.length;s<i&&!((t=parseInt(e[s].id,10))<=this.latestId);s++)n++;n>0&&(this.latestId=e.length>0?parseInt(e[0].id,10):0,this.notifyNewArrived(e.slice(0,n))),setTimeout(()=>this.loadNewEvents(),this.interval)}stopAutoLoad(){this.interval=0}notifyNewArrived(e){const t=this.applyMention(e),n={title:`GitHub ${this.name}`,message:`${e.length} new event(s)`,mentions:t};this.say("newArrived",{newItems:e,notify:n})}applyMention(e){if(!this.loginUser)return;const t=["issue","comment","pullRequest","review"];let n=0,s="@"+this.loginUser.login;return e.forEach(e=>{let i=e.payload;if(i.body&&i.body.indexOf(s)>-1)return e.mention=!0,void n++;t.some(t=>{if(i[t]&&i[t].body&&i[t].body.indexOf(s)>-1)return e.mention=!0,n++,!0})}),n}async fetchPullReqDetail(e,t,n){const s=(await this.v4client("query ($owner: String!, $repoName: String!, $number: Int!) {\n      repository(owner: $owner, name: $repoName) {\n        pullRequest(number: $number) {\n          number\n          title\n          url\n          author {\n            login\n            avatarUrl\n          }\n          baseRefName\n          headRefName\n          headRepository {\n            nameWithOwner\n          }\n          bodyHTML\n          state\n          mergeable\n          databaseId\n          updatedAt\n          reviewRequests(first: 10) {\n            edges {\n              node {\n                requestedReviewer {\n                  ... on User {\n                    login\n                    avatarUrl\n                  }\n                }\n              }\n            }\n          }\n          reviews(last: 5, states: [APPROVED, CHANGES_REQUESTED, DISMISSED, PENDING]) {\n            edges {\n              node {\n                author {\n                  login\n                  avatarUrl\n                }\n                resourcePath\n                bodyHTML\n                submittedAt\n                updatedAt\n                state\n              }\n            }\n          }\n        }\n      }\n    }",{owner:e,repoName:t,number:n})).repository.pullRequest;if(s.reviewRequests.edges.length)for(let e of s.reviewRequests.edges)if(e.node.requestedReviewer.login===this.loginUser.login)return s.kind="requested_review",s;let i={};if(s.reviews.edges.length)for(let e of s.reviews.edges){const t=e.node.author.login;t!==this.loginUser.login&&(s.kind="reviewed",i[t]=e.node)}return Object.values(i).map(e=>{const t=Object.assign({review:e},s);return t.updatedAt=e.updatedAt,t})}};function K(e,t){this.rootUrl=e,this.views=function(e){class t extends b{html(e){return`      <p class="pushCommit">\n        <a href="${e.commitUrl}"><code>${e.sha}</code></a>\n        <span class="msg">${e.message}</span>\n      </p>`}load(e,t){t.msg_click=function(e,t){e.classList.toggle("expanded")}}}class n extends b{html(e){return`      <span>\n        <span class="word">${e.action}</span>\n        <span class="action wiki"><span class="octicon octicon-${e.octicon}"></span></span>\n        <a class="repoTarget" href="${e.htmlUrl}">${e.title}</a>\n      </span>`}}return{CommitCommentView:class extends b{html(e){return`      <div class="commitCommentEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.comment.htmlUrl}"><time>${e.comment.createdAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.comment.user.htmlUrl}">\n            <img class="avatar avatar-small" src="${e.comment.user.avatarUrl}">\n            <span>${e.comment.user.login}</span>\n          </a>\n          <span class="action"><span class="octicon octicon-comment"></span></span>\n          <span class="word" style="margin-left:.8ex">on</span>\n          <span class="repoTarget">\n            <span class="octicon octicon-git-commit"></span>\n            <a href="${e.comment.htmlUrl}">\n              <code>${e.sha}</code>\n              <span class="filePath">${e.comment.path}</span>\n            </a>\n          </span>\n        </div>\n        <div class="commentBody quote"></div>\n      </div>`}load(e,t){this.data.comment.diffHunk&&(this.findEl(".diffBody").innerHTML=Q(this.data.comment.diffHunk)),this.findEl(".commentBody").innerHTML=Z(this.data.comment.body||"")}},GollumView:class extends b{html(e){return`      <div class="gollumEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <span class="eventTime"><time>${e.createdAt}</time></span>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.actor.url}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <span class="gollumPageUpdates"></span>\n        </div>\n      </div>`}load(e,t){e.pages=new y(this.findEl(".gollumPageUpdates"),n)}},IssuesView:class extends b{html(e){return`      <div class="issueEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.htmlUrl}"><time>${e.createdAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <p class="eventTitle">\n            <span class="octicon octicon-${e.octicon} ${e.action}"></span>\n            <a class="issueTitle" href="${e.htmlUrl}">#${e.number} ${e.title}</a>\n          </p>\n        </div>\n        <div class="issueBody quote"></div>\n      </div>`}load(e,t){const n=this.findEl(".issueBody");"opened"==this.data.action?(n.innerHTML=Z(this.data.body||""),this.data.mention&&n.classList.add("mentioned")):n&&this.el.removeChild(n)}},IssueCommentView:class extends b{html(e){return`      <div class="issueEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.comment.htmlUrl}"><time>${e.comment.createdAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.comment.user.htmlUrl}">\n            <img class="avatar avatar-small" src="${e.comment.user.avatarUrl}">\n            <span>${e.comment.user.login}</span>\n          </a>\n          <span class="action"><span class="octicon octicon-comment-discussion"></span></span>\n        </div>\n        <div class="sub">\n          <p class="eventTitle">\n            <span class="octicon octicon-${e.octicon}"></span>\n            <a class="issueTitle" href="${e.issue.htmlUrl}">#${e.issue.number} ${e.issue.title}</a>\n          </p>\n          <div class="issueBody quote"></div>\n        </div>\n        <div class="commentBody quote"></div>\n      </div>`}load(e,t){const n=this.findEl(".issueBody");if(t.issueBody_click=((e,t)=>{e.classList.toggle("full")}),this.data.comment.body){this.data.issue.body&&(n.innerHTML=Z(this.data.issue.body),this.data.mention&&n.classList.add("mentioned"));var s=this.findEl(".commentBody");s.innerHTML=Z(this.data.comment.body||""),this.data.mention&&s.classList.add("mentioned")}else if(null!=this.data.issue.labels){var i=this.data.issue.labels[0];n.innerHTML='<span style="background-color:#'+i.color+'">'+i.name+"</span>"}else console.log(this.data.issue)}},PullRequestView:class extends b{html(e){return`      <div class="pullReqEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.pullRequest.htmlUrl}"><time>${e.createdAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <span class="mergeTarget">\n            <a class="branch-ref" href="${e.pullRequest.head.repo.htmlUrl}/tree/${e.pullRequest.head.ref}">${e.pullRequest.head.ref}</a>\n            <span class="octicon octicon-arrow-small-right"></span>\n            <a class="branch-ref" href="${e.pullRequest.base.repo.htmlUrl}/tree/${e.pullRequest.base.ref}">${e.pullRequest.base.ref}</a>\n          </span>\n          <p class="eventTitle">\n            <span class="action ${e.action}"><span class="octicon octicon-${e.octicon}"></span></span>\n            <a class="issueTitle" href="${e.pullRequest.htmlUrl}">#${e.number} ${e.pullRequest.title}</a>\n          </p>\n        </div>\n        <div class="pullReqBody quote"></div>\n      </div>`}load(e,t){var n=this.findEl(".pullReqBody");"closed"!==this.data.action?this.data.pullRequest.body&&(n.innerHTML=Z(this.data.pullRequest.body||""),this.data.mention&&n.classList.add("mentioned")):n&&this.el.removeChild(n)}},PullRequestReviewView:class extends b{html(e){return`      <div class="issueEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.review.htmlUrl}"><time>${e.review.submittedAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.comment.user.htmlUrl}">\n            <img class="avatar avatar-small" src="${e.comment.user.avatarUrl}">\n            <span>${e.comment.user.login}</span>\n          </a>\n          <span class="action"><span class="octicon octicon-comment-discussion"></span></span>\n        </div>\n        <div class="sub">\n          <p class="eventTitle">\n            <span class="octicon octicon-${e.octicon}"></span>\n            <a class="issueTitle" href="${e.pullRequest.htmlUrl}">#${e.number} ${e.pullRequest.title}</a>\n          </p>\n          <div class="issueBody quote"></div>\n        </div>\n        <div class="commentBody quote"></div>\n      </div>`}load(e,t){var n=this.findEl(".issueBody");if(t.issueBody_click=((e,t)=>{e.classList.toggle("full")}),this.data.review.body){this.data.pullRequest.body&&(n.innerHTML=Z(this.data.pullRequest.body));var s=this.findEl(".commentBody");s.innerHTML=Z(this.data.review.body||""),this.data.mention&&s.classList.add("mentioned")}if(this.data.state.match(/^approved$/i)){var i=this.data.issue.labels[0];n.innerHTML='<span style="background-color:#'+i.color+'">'+i.name+"</span>"}}},PullRequestReviewCommentView:class extends b{html(e){return`      <div class="issueEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.comment.htmlUrl}"><time>${e.comment.createdAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.comment.user.htmlUrl}">\n            <img class="avatar avatar-small" src="${e.comment.user.avatarUrl}">\n            <span>${e.comment.user.login}</span>\n          </a>\n          <span class="action"><span class="octicon octicon-comment"></span></span>\n        </div>\n        <div class="sub">\n          <p class="eventTitle">\n            <span class="octicon octicon-git-pull-request"></span>\n            <a class="issueTitle" href="${e.pullRequest.htmlUrl}">#${e.pullRequest.number} ${e.pullRequest.title}</a>\n          </p>\n          <div class="diff quote">\n            <p class="filePath"><a href="${e.comment.htmlUrl}">${e.comment.path}</a></p>\n            <div class="diffBody"></div>\n          </div>\n        </div>\n        <div class="commentBody quote"></div>\n      </div>`}load(e,t){this.findEl(".diffBody").innerHTML=Q(this.data.comment.diffHunk);let n=this.findEl(".commentBody");n.innerHTML=Z(this.data.comment.body||""),this.data.mention&&n.classList.add("mentioned")}},PushView:class extends b{html(e){return`      <div class="pushEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.htmlUrl}"><time>${e.createdAt}</time></a>\n        </header>\n\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <span class="action push">\n            <span class="word">pushed</span>\n            <span class="octicon octicon-repo-push"></span>\n          </span>\n          <span class="repoTarget">\n            <a class="branch-ref" href="${e.rootUrl}/${e.repo.name}/tree/${e.branch}">${e.branch}\n            </a>\n          </span>\n        </div>\n\n        <div class="pushCommits"></div>\n      </div>`}load(e,n){e.commits=new y(this.findEl(".pushCommits"),t)}},CreateView:class extends b{html(e){return`      <div class="createEvent ghEvent">\n        <time class="eventTime">${e.createdAt}</time>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n           <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n           <span>${e.actor.login}</span>\n          </a>\n          <span class="word">created</span>\n          <span class="repoTarget">\n            <span class="octicon octicon-${e.octicon}"></span>\n            <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          </span>\n        </div>\n      </div>`}},ForkView:class extends b{html(e){return`      <div class="forkEvent ghEvent">\n        <time class="eventTime">${e.createdAt}</time>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <span class="word">forked</span>\n          <a href="${e.forkee.htmlUrl}" class="action fork"><span class="octicon octicon-repo-forked"></span></a>\n          <span class="repoTarget">\n            <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          </span>\n        </div>\n      </div>`}},MemberView:class extends b{html(e){return`      <div class="memberEvent ghEvent">\n        <time class="eventTime">${e.createdAt}</time>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <span class="word">${e.action}</span>\n          <a class="actor" href="${e.rootUrl}/${e.member.login}">\n            <img class="avatar avatar-small" src="${e.member.avatarUrl}">\n            <span>${e.member.login}</span>\n          </a>\n          <span class="octicon octicon-arrow-small-right"></span>\n          <span class="repoTarget">\n            <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          </span>\n        </div>\n      </div>`}},PublicView:class extends b{html(e){return`      <div class="publicEvent ghEvent">\n        <time class="eventTime">${e.createdAt}</time>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <span class="word">made</span>\n          <span class="repoTarget">\n            <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          </span>\n          <span class="word">public</span>\n        </div>\n      </div>`}},ReleaseView:class extends b{html(e){return`      <div class="releaseEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          <a class="eventTime" href="${e.htmlUrl}"><time>${e.createdAt}</time></a>\n        </header>\n\n        <div class="eventInfo">\n          <a class="actor" href="${e.author.htmlUrl}">\n            <img class="avatar avatar-small" src="${e.author.avatarUrl}">\n            <span>${e.author.login}</span>\n          </a>\n          <span class="word">released</span>\n          <span class="repoTarget">\n            <a href="${e.htmlUrl}"><span class="octicon octicon-tag"></span> ${e.tagName}</a>\n          </span>\n          <span class="repoTarget">\n            <span class="word">on</span>\n            <span class="branch-ref">${e.targetCommitish}</span>\n          </span>\n        </div>\n      </div>`}},WatchView:class extends b{html(e){return`      <div class="watchEvent ghEvent">\n        <time class="eventTime">${e.createdAt}</time>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.actor.login}">\n            <img class="avatar avatar-small" src="${e.actor.avatarUrl}">\n            <span>${e.actor.login}</span>\n          </a>\n          <span class="action star"><span class="octicon octicon-star"></span></span>\n          <span class="repoTarget">\n            <a class="repo" href="${e.rootUrl}/${e.repo.name}">${e.repo.name}</a>\n          </span>\n        </div>\n      </div>`}}}}()}function Q(e){for(var t=e.split("\n"),n=['<p class="head">'+t[0]+"</p>"],s=1,i=t.length;s<i;s++){var a=t[s].charAt(0);"+"===a?n.push('<p class="plus">'+t[s]+"</p>"):"-"===a?n.push('<p class="minus">'+t[s]+"</p>"):n.push('<p class="normal">'+t[s]+"</p>")}return n.join("")}K.prototype={createView:function(e){return e.type in this?this[e.type](e):null},CommitCommentEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=t.comment.user,t.repo=e.repo,t.sha=t.comment.commitId.substr(0,6),t.comment.createdAt=D(t.comment.createdAt),new this.views.CommitCommentView({data:t})},CreateEvent:function(e){var t=e.payload;if("repository"===t.refType)return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.repo.rootUrl="https://github.com",t.createdAt=D(e.createdAt),t.octicon="repo",new this.views.CreateView({data:t})},ForkEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),new this.views.ForkView({data:t})},GollumEvent:function(e){const t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),t.pages=t.pages.map(e=>({sha:e.sha.substr(0,6),action:e.action,octicon:"created"===e.action?"book":"pencil",title:e.title,htmlUrl:e.htmlUrl})),new this.views.GollumView({data:t})},IssuesEvent:function(e){var t=e.payload.issue;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.octicon="issue-"+e.payload.action,t.action=e.payload.action,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),new this.views.IssuesView({data:t})},IssueCommentEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.octicon=t.issue.pullRequest?"git-pull-request":"issue-opened",t.createdAt=D(e.createdAt),t.comment.createdAt=D(t.comment.createdAt),new this.views.IssueCommentView({data:t})},MemberEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),new this.views.MemberView({data:t})},PublicEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),new this.views.PublicView({data:t})},PullRequestEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),t.pullRequest.createdAt=D(t.pullRequest.createdAt),"opened"==t.action?t.octicon="git-pull-request":"closed"==t.action&&t.pullRequest.merged?(t.action="merged",t.octicon="git-merge"):t.octicon="circle-slash",new this.views.PullRequestView({data:t})},PullRequestReviewEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),t.review.submittedAt=D(t.review.submitted_at),t.review.state.match(/^approved$/i)?t.octicon="check":"closed"==t.action&&t.pullRequest.merged?(t.action="merged",t.octicon="git-merge"):t.octicon="circle-slash",new this.views.PullRequestReviewView({data:t})},PullRequestReviewCommentEvent:function(e){var t=e.payload;return t.mention=e.mention,t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),t.comment.createdAt=D(t.comment.createdAt),new this.views.PullRequestReviewCommentView({data:t})},PushEvent:function(e){var t,n=e.payload;return n.rootUrl=this.rootUrl,n.branch=n.ref.replace(/^refs\/heads\//,""),n.shortSha=n,n.actor=e.actor,n.repo=e.repo,n.commits=(t=this.rootUrl+"/"+n.repo.name,n.commits.map(function(e){return{sha:e.sha.substr(0,6),commitUrl:t+"/commit/"+e.sha,message:e.message}})),n.createdAt=D(e.createdAt),new this.views.PushView({data:n})},ReleaseEvent:function(e){console.log(e);var t=e.payload.release;return t.rootUrl=this.rootUrl,t.repo=e.repo,t.createdAt=D(t.publishedAt),new this.views.ReleaseView({data:t})},WatchEvent:function(e){var t=e.payload;return t.rootUrl=this.rootUrl,t.actor=e.actor,t.repo=e.repo,t.createdAt=D(e.createdAt),new this.views.WatchView({data:t})}};const X=new marked.Renderer;function Z(e){return marked(e,{renderer:X})}X.heading=function(e,t,n){return"<h"+t+">"+e+"</h"+t+">\n"};var ee=K;function te(e,t){this.rootUrl=e,this.views=function(e){return{PullRequestReviewRequestedView:class extends b{html(e){return`      <div class="pullReqEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.headRepository.nameWithOwner}">${e.headRepository.nameWithOwner}</a>\n          <a class="eventTime" href="${e.url}"><time>${e.updatedAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.author.login}">\n            <img class="avatar avatar-small" src="${e.author.avatarUrl}">\n            <span>${e.author.login}</span>\n          </a>\n          <span class="action requested_review">\n            <span class="word">requested you review</span>\n          </span>\n          <p class="eventTitle">\n            <span class="action ${e.action}"><span class="octicon octicon-${e.octicon}"></span></span>\n            <a class="issueTitle" href="${e.url}">#${e.number} ${e.title}</a>\n          </p>\n        </div>\n        <div class="pullReqBody quote"></div>\n      </div>`}load(e,t){var n=this.findEl(".pullReqBody");"closed"!==this.data.action?n.innerHTML=this.data.bodyHTML:n&&this.el.removeChild(n)}},PullRequestReviewedView:class extends b{html(e){return`      <div class="issueEvent ghEvent">\n        <header>\n          <a class="repo" href="${e.rootUrl}/${e.headRepository.nameWithOwner}">${e.headRepository.nameWithOwner}</a>\n          <a class="eventTime" href="${e.url}"><time>${e.updatedAt}</time></a>\n        </header>\n        <div class="eventInfo">\n          <a class="actor" href="${e.rootUrl}/${e.review.author.login}">\n            <img class="avatar avatar-small" src="${e.review.author.avatarUrl}">\n            <span>${e.review.author.login}</span>\n          </a>\n          <span class="action">\n            <span class="word">${e.action}</span>\n          </span>\n          <span class="action"><span class="octicon octicon-${e.actionOcticon}"></span></span>\n        </div>\n        <div class="sub">\n          <p class="eventTitle">\n            <span class="octicon octicon-${e.octicon}"></span>\n            <a class="issueTitle" href="${e.url}">#${e.number} ${e.title}</a>\n          </p>\n          <div class="issueBody quote"></div>\n        </div>\n        <div class="commentBody quote"></div>\n      </div>`}load(e,t){var n=this.findEl(".issueBody");t.issueBody_click=((e,t)=>{e.classList.toggle("full")}),n.innerHTML=this.data.bodyHTML;var s=this.findEl(".commentBody");s.innerHTML=this.data.review.bodyHTML}}}}()}te.prototype={createView:function(e){if(e.rootUrl=this.rootUrl,e.updatedAt=D(e.updatedAt),e.reviewRequest&&(e.reviewRequest.submittedAt=D(e.reviewRequest.submittedAt)),"requested_review"===e.kind){const{state:t}=e;return"OPEN"==t?e.octicon="git-pull-request":"MERGED"===t?e.octicon="git-merge":"CLOSED"===t&&(e.octicon="circle-slash"),new this.views.PullRequestReviewRequestedView({data:e})}if("reviewed"===e.kind){switch(e.review.state){case"APPROVED":e.action="approved",e.actionOcticon="check";break;case"CHANGES_REQUESTED":e.action="requested the changes",e.actionOcticon="x";break;default:e.action="commented",e.actionOcticon="comment"}return new this.views.PullRequestReviewedView({data:e})}}};var ne=te;class se extends b{html(){return'<div class="githubItem"></div>'}load(e,t){const{viewFactory:n}=this.data,s=n.createView(this.data);s&&(this.add("item",s),this.data.newArrival&&this.el.classList.add("newArrival"))}}var ie=class extends M{get itemViewClass(){return se}html(e){return`    <div class="timeline github">\n      <header class="timelineHeader">\n        <a href="" target="_blank">\n          <span class="service">GitHub</span>\n          <span class="project">${e.caption}</span>\n        </a>\n      </header>\n      <div class="timelineBody"></div>\n    </div>`}loadStream(e){let{token:t,endpoint:n}=e;n&&n.match(/^https?\:\/\/github\.com\/?$/)&&(n=null),this.model=new z(t,n),this.model.activate(e).then(()=>{if("event"===this.model.type){const e=new ee(this.model.webUrl);this.items.itemClass=class extends o{get viewFactory(){return e}}}else if("notification"===this.model.type){const e=new ne(this.model.webUrl);this.items.itemClass=class extends o{get viewFactory(){return e}}}this.findEl(".timelineHeader > a").href=this.model.url}).catch(e=>{console.error(e),alert("Can't fetch GitHub information")}),this.model.listen("refresh",e=>this.refreshed(e)),this.model.listen("newArrived",e=>this.loadMore(e))}};class ae extends b{html(e){return`<div class="deckColumn ${e.width||"normal"}"></div>`}load(e){"backlog"===this.data.service?e.timeline=new J({parent:this,data:this.data}):"github"==this.data.service&&(e.timeline=new ie({parent:this,data:this.data}))}}class oe extends y{constructor(e,t){super(e,ae,t)}load(e,t){(e=>{e.indexOf("windows")>-1&&-1===e.indexOf("phone")&&-1===e.indexOf("touch")&&(this.el.className="windowsScroller")})(window.navigator.userAgent.toLowerCase());const n=document.documentElement.clientWidth;if(n>440)this.el.classList.add("bounding");else{this.scrollLeft=0,this.columnIdx=0;let e,s=0,i=0;t.touchstart=((t,n)=>{e=s=n.touches[0].pageX,i=n.touches[0].pageY}),t.touchmove=((t,n)=>{let a=n.touches[0].pageX,o=n.touches[0].pageY;i<0||Math.abs(o-i)>Math.abs(a-s)/2?i=null:(this.scrollLeft=s-a,e=a)}),t.touchend=((t,a)=>{null!==i?(Math.abs(this.scrollLeft)>=30&&(e>s?this.columnIdx--:this.columnIdx++),this.el.scrollLeft!==this.columnIdx*n&&$(this.el).animate({scrollLeft:this.columnIdx*n},80)):$(this.el).animate({scrollLeft:this.columnIdx*n},120)})}V.listen("clear",()=>{document.querySelectorAll(".newArrival").forEach(e=>e.classList.remove("newArrival"))})}}const re=new w;var le=class extends m{html(){return'<div>\n  <nav id="naviPanel">\n    <a href="#!settings" title="Setting" target="_self"><span class="mega-octicon octicon-gear"></span></a>\n  </nav>\n  <main id="deck">\n  </main>\n</div>'}load(e,t){e.deckView=new oe("#deck",{data:re}),window.history.replaceState({},document.title,window.location.pathname);const n=this.loadTimelines();n.length?re.reset(n):g.go("intro")}loadTimelines(){try{const e=localStorage.getItem("timelines");return JSON.parse(e)||[]}catch(e){return[]}}};const ce=new w;var de=class extends m{title(){return"Demo"}html(){return'<div>\n  <nav id="naviPanel">\n    <a href="#!intro" title="Exit" target="_self"><span class="mega-octicon octicon-sign-out"></span></a>\n  </nav>\n  <main id="deck"></main>\n</div>'}load(e,t){e.deckView=new oe("#deck",{data:ce}),ce.reset(this.loadTimelines()),this.timeoutId=setTimeout(()=>{alert("Demo exiting and return introduction page"),g.go("intro")},12e4)}unload(){this.timeoutId&&clearTimeout(this.timeoutId)}loadTimelines(){return[{service:"github",width:"wide",notify:"off",kind:"public_timeline",caption:"Public Timeline",token:null,endpoint:null}]}};g.activate(class extends m{constructor(){super(document.body,{childFrame:"#contentBody"})}title(e){return e?`Deck - ${e}`:"Deck"}},{index:le,intro:class extends m{title(){return"Introduction"}html(){return'<div id="introPage">\n  <div class="wall"></div>\n  <div class="intro">\n    <h1>\n      <img src="img/apple-touch-icon-72x72.png" style="border-radius: 8px; vertical-align: middle;">\n      <span>Deck</span>\n    </h1>\n\n    <div class="content">\n      <p>\n        &apos;Deck&apos; is a multi-timeline viewer for <a href="https://github.com/" rel="nofollow">GitHub</a> repository events.<br>\n        It is also supported for <a href="http://www.backlog.jp/" rel="nofollow">Backlog</a> produced by Nulab Inc.<br>\n        It is made of responsive design for PC or mobile modern browsers.\n      </p>\n\n      <div class="buttons clearfix">\n        <a class="button primary" href="#!/settings" target="_self">Get Started Now</a>\n        <a class="button" href="#!/demo" target="_self">See a Demo</a>\n      </div>\n\n      <p>\n        All your account data are saved in local storage of the browser.<br>\n        Your data is not saved on server-side at all.<br>\n        Setting import/export is supported so as to move yours to another browser.\n      </p>\n    </div>\n\n    <footer>\n      <p class="links">\n        <a href="#!/term" target="_self">Terms &amp; Privacy</a>\n        <a href="https://github.com/tilfin/deck">GitHub Repository</a>\n      </p>\n      <p>&apos;Deck&apos; is not a representative of GitHub. GitHub and the GitHub logos are Trademarks of GitHub, Inc.<br> All other trademarks and copyrights are property of their respective owners.</p>\n      <p>&copy; 2016 <a href="https://github.com/tilfin">tilfin</a> all rights reserved.</p>\n    </footer>\n  </div>\n</div>'}load(e,t){window.history.replaceState({},document.title,window.location.pathname)}},demo:de,term:class extends m{title(){return"Terms & Privacy"}html(){return'<div class="setting page">\n  <div id="termPage">\n    <h1>Terms &amp; Privacy</h1>\n\n    <section>\n      <h2>Terms of Service</h2>\n\n      <p>You are responsible for your use of the services, and for any consequences thereof.\n  Your access to and use of the service or any content are at your own risk.</p>\n    </section>\n      <h2>Disclaimer of Warranties</h2>\n\n      <p>We disclaim all warranties and conditions, whether express or implied, of merchantability, fitness for a particular purpose, or non-infringement.</p>\n    </section>\n\n    <section>\n      <h2>Privacy</h2>\n\n      <p>We collect access log such as your IP address, browser, operating system, the referring web page and pages visited not contain your account or your subscriptions and theirs contents information).</p>\n    </section>\n\n    <div class="buttons clearfix">\n      <a href="#!/intro" class="button back" target="_self">Back</a>\n    </div>\n\n    <footer>\n      <p>&apos;Deck&apos; is not a representative of GitHub. GitHub and the GitHub logos are Trademarks of GitHub, Inc.<br> All other trademarks and copyrights are property of their respective owners.</p>\n      <p>&copy; 2016 <a href="https://github.com/tilfin">tilfin</a> all rights reserved.</p>\n    </footer>\n  </div>\n</div>'}},settings:{index:class extends m{title(){return"Settings"}html(){return'<div class="setting page">\n  <h1>Settings</h1>\n\n  <nav class="naviList">\n    <a href="#!settings/timeline" target="_self">Customize timelines</a>\n    <a href="#!settings/port" target="_self">Import/Export setting</a>\n    <a href="#!term" target="_self">Terms &amp; Privacy</a>\n    <a href="#!settings/credit" target="_self">Credit</a>\n  </nav>\n\n  <div class="buttons clearfix">\n    <a href="#!/" class="button" target="_self">Back</a>\n  </div>\n\n  <footer>\n    <p>&apos;Deck&apos; is not a representative of GitHub. GitHub and the GitHub logos are Trademarks of GitHub, Inc.<br> All other trademarks and copyrights are property of their respective owners.</p>\n    <p>&copy; 2016 <a href="https://github.com/tilfin">tilfin</a> all rights reserved.</p>\n  </footer>\n</div>'}},timeline:class extends m{title(){return"Customize timelines"}html(){return'<div class="setting page">\n  <h1>Customize timelines</h1>\n\n  <div id="showcase"></div>\n\n  <section>\n    <h3>Add timeline</h3>\n\n    <div class="buttons clearfix">\n      <a id="addGithubColumnButton" class="button service" href="#!settings/github" target="_self">\n        <span class="mega-octicon octicon-mark-github"></span>\n        <span class="caption">GitHub</span>\n      </a>\n\n      <a id="addBacklogColumnButton" class="button service" href="#!settings/backlog" target="_self">\n        <img src="img/backlog-icon.png" width="32" height="32">\n        <span class="caption">Backlog</span>\n      </a>\n    </div>\n  </section>\n\n  <div class="buttons clearfix">\n    <button class="button back" id="cancelButton">Cancel</button>\n    <button class="button primary" id="saveButton">Save</button>\n  </div>\n</div>'}load(e,t){this.timelines=new w,e.showcase=new q("#showcase",j,{data:this.timelines}),this.timelines.reset(this.loadTimelines());let n=this.context.newTimeline;n&&this.timelines.add(n),t.cancelButton_click=(()=>{this.needSave=!1,g.go("settings")}),t.saveButton_click=(()=>{this.needSave=!0,g.go("/",{timelines:this.timelines})})}unload(){this.needSave&&(localStorage.setItem("timelines",JSON.stringify(this.timelines._data)),this.timelines.some(e=>"off"!=e.notify)&&"Notification"in window&&Notification.requestPermission())}loadTimelines(){try{const e=localStorage.getItem("timelines");return e?JSON.parse(e):[]}catch(e){return[]}}},backlog:P,github:O,port:class extends m{title(){return"Import/Export setting"}html(){return'<div class="setting page">\n  <h1>Import/Export</h1>\n\n  <form id="portForm">\n    <div class="field">\n      <label for="snippet">Setting JSON:</label>\n      <textarea id="snippet"></textarea>\n    </div>\n\n    <div class="buttons clearfix">\n      <button class="button" id="exportButton">Show current setting</button>\n      <button class="button primary" id="importButton">Apply json to setting</button>\n    </div>\n  </form>\n  <hr>\n  <div class="buttons clearfix">\n    <a href="#!settings" class="button back" target="_self">Back</a>\n  </div>\n</div>'}load(e,t){t.importButton_click=(()=>{try{const e=JSON.parse(this.findEl("#snippet").value);if(!e.timelines||!e.defaults)return void alert("Invalid data");localStorage.setItem("defaults",JSON.stringify(e.defaults)),localStorage.setItem("timelines",JSON.stringify(e.timelines)),App.go("/")}catch(e){alert("Invalid JSON format")}return!1}),t.exportButton_click=(()=>{let e=localStorage.getItem("defaults"),t=localStorage.getItem("timelines");return e=JSON.parse(e),t=JSON.parse(t),this.findEl("#snippet").value=JSON.stringify({defaults:e,timelines:t}),!1}),t.snippet_focus=(()=>{this.select()})}},credit:class extends m{title(){return"Credit"}html(){return'<div class="setting page">\n  <div id="creditPage">\n    <h1>Credits</h1>\n\n    <section>\n      <h2>marked</h2>\n\n      <blockquote>\n  Copyright (c) 2011-2014, Christopher Jeffrey (https://github.com/chjj/)\n\n  Permission is hereby granted, free of charge, to any person obtaining a copy\n  of this software and associated documentation files (the "Software"), to deal\n  in the Software without restriction, including without limitation the rights\n  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the Software is\n  furnished to do so, subject to the following conditions:\n\n  The above copyright notice and this permission notice shall be included in\n  all copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n  THE SOFTWARE.\n      </blockquote>\n    </section>\n\n    <section>\n      <h2>Octicons</h2>\n\n      <blockquote>\n  (c) 2012-2016 GitHub\n\n  When using the GitHub logos, be sure to follow the GitHub logo guidelines (https://github.com/logos)\n\n  Font License: SIL OFL 1.1 (http://scripts.sil.org/OFL)\n  Applies to all font files\n\n  Code License: MIT (http://choosealicense.com/licenses/mit/)\n  Applies to all other files\n      </blockquote>\n    </section>\n\n    <section>\n      <h2>Octokat.js</h2>\n\n      <blockquote>\n  Copyright (c) 2015 Philip Schatz\n\n  Permission is hereby granted, free of charge, to any person obtaining a\n  copy of this software and associated documentation files (the\n  "Software"), to deal in the Software without restriction, including\n  without limitation the rights to use, copy, modify, merge, publish,\n  distribute, sublicense, and/or sell copies of the Software, and to\n  permit persons to whom the Software is furnished to do so, subject to\n  the following conditions:\n\n  The above copyright notice and this permission notice shall be included\n  in all copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n  OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n  IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n  CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n  TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n      </blockquote>\n    </section>\n\n    <section>\n      <h2>Primer</h2>\n\n      <blockquote>\n  The MIT License (MIT)\n\n  Copyright (c) 2015 GitHub, Inc.\n\n  Permission is hereby granted, free of charge, to any person obtaining a copy\n  of this software and associated documentation files (the "Software"), to deal\n  in the Software without restriction, including without limitation the rights\n  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the Software is\n  furnished to do so, subject to the following conditions:\n\n  The above copyright notice and this permission notice shall be included in all\n  copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n  SOFTWARE.\n      </blockquote>\n    </section>\n\n    <div class="buttons clearfix">\n      <a href="#!/settings" class="button back" target="_self">Back</a>\n    </div>\n  </div>\n</div>'}}}},{mode:"HASH"})}]);